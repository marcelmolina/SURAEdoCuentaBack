
def getHeadColumnsBonos(extension,tipo):
	lista = []
	if tipo in ['A','P']:
		lista.append('# Bono')
		lista.append('Tipo Bono')
		lista.append('Subtipo Bono')
		if extension == "excel":
			lista.append('Grupo')
		lista.append('Oficina')
		lista.append('Ramo')
		lista.append('Poliza')
		lista.append('Contratante')
		if extension == "excel":
			lista.append('Agentes')
		lista.append('Computabilidad')
		if extension == "excel":
			lista.append('Causa de No Computabilidad')
		lista.append('Tipo Cambio')
		lista.append('# Recibo')
		lista.append('Serie')
		lista.append('Prima Total')
		lista.append('Prima Neta')
		lista.append('% Bono Pagado')
		lista.append('Monto comisión neta')
		lista.append('Total comisión pagada')
		lista.append('# Liquidación')
		if extension == "excel":
			lista.append('# Comprobante')
		lista.append('Fecha aplicación de la póliza')

	if tipo == 'UDI':
		lista.append('# Bono')
		if extension == "excel":
			lista.append('Tipo Bono')
			lista.append('Subtipo Bono')
		lista.append('Grupo')
		lista.append('Oficina')
		lista.append('Ramo')
		lista.append('Poliza')
		lista.append('Contratante')
		lista.append('Tipo Cambio')
		lista.append('# Recibo')
		lista.append('Prima Total')
		lista.append('Prima Neta')
		lista.append('% Prestacion de servicio')
		lista.append('Monto comisión neta')
		lista.append('Total comisión pagada')
		lista.append('# Liquidación')
		if extension == "excel":
			lista.append('# Comprobante')
		lista.append('Fecha aplicación de la póliza')
	return lista


def getHeadColumnsComisones(extension,cursor):
	lista = []
	if cursor in [1,2]:
		lista.append("TIPO")
		lista.append("BASE")
		lista.append("IVA")
		lista.append("SUBTOTAL")
		lista.append("IVARETENIDO")
		lista.append("ISR")
		lista.append("IMP. CEDULAR")
		lista.append("TOTAL")
		return lista
	if cursor in [3,4,7,8]:
		lista.append("CONCEPTO")
		lista.append("IMPORTE")
		return lista

	if cursor in [5,6,9,10]:
		lista.append("Daños/Vida")
		if extension =="excel":
			lista.append("Grupo")
		lista.append("Oficina")
		lista.append("Ramo")
		lista.append("Poliza")
		lista.append("Contratante")
		if extension == "excel":
			lista.append("Clave Agente")
		lista.append("Tipo de Cambio")
		lista.append("# Recibo")
		lista.append("Serie de Recibo")
		lista.append("Prima Total")
		lista.append("Prima Neta")
		lista.append("% Comisión pagado")
		lista.append("% Comisión de derecho")
		lista.append("Monto Comisión Neta")
		lista.append("Total Comisión pagado")
		lista.append("# Liquidación")
		if extension == "excel":
			lista.append("# Comprobante")
		lista.append("Fecha aplicación de la póliza")
		return lista

	if cursor in [11,12]:
		lista.append("FECHA DE LIQUIDACIÓN")
		lista.append("DAÑOS")
		lista.append("VIDA")
		lista.append("TOTAL")
		lista.append("FECHA DE PAGO")
		lista.append("NUMERO DE COMPROBANTE")
		lista.append("IMPORTEPAGADO DAÑOS")
		lista.append("IMPORTE PAGADO VIDA")
		lista.append("TOTAL")
		return lista
	return lista


def getTipoSubBono(id):
	codigo=""
	if id == 20:
		return "BS"
	if id == 30:
		return "BC"
	if id == 40:
		return "BP"
	if id == 50:
		return "BSE"
	if id == 60:
		return "BCS"
	if id == 70:
		return "BPS"
	if id == 80:
		return "BPF"
	if id == 82:
		return "BD"
	return codigo


def getTableNamesComisiones(tabla):
	nombre=[]
	if tabla == 1:
		return "TOTAL DE PERCEPCIONES MENSUALES"
	if tabla == 2:
		return "TOTAL DE PERCEPCIONES ACUMULADO ANUAL"
	if tabla in [3,4]:
		return "CONCEPTOS DE DAÑOS"
	if tabla in [5]:
		return "DAÑOS MONEDA MXP"
	if tabla in [6]:
		return "DAÑOS MONEDA USD"
	if tabla in [9]:
		return "VIDA MONEDA MXP"
	if tabla in [10]:
		return "VIDA MONEDA USD"
	if tabla in [7,8]:
		return "CONCEPTOS DE VIDA"
	if tabla == 11:
		return "RESUMEN DE DEPOSITOS EN MXP"
	if tabla == 12:
		return "RESUMEN DE DEPOSITOS EN USD"
	return nombre


def getquery(clave,tipo,tabla,codigo,desde,hasta):
	query = ""
	if clave == 'UDI':
		if tipo == 'BONO':
			if tabla == 0:
				query = getheaderquery('UDI',codigo,desde,hasta)
			if tabla == 1:
				query = f"SELECT MAIN.NMBONO,MAIN.DSBONO,MAIN.CDTIPBON, MAIN.CDGRUPO,MAIN.CDUNIECO, MAIN.CDRAMO,MAIN.NMPOLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.TIPOCAMB, MAIN.NMRECIBO, NVL(MAIN.PMATOTAL,0) PRIMA_TOTAL, NVL(MAIN.PMANETAP,0) PRIMA_NETA, MAIN.PORCEPAG, ABS(MAIN.IMPORPROV), (ABS(MAIN.IMPORPROV)+ABS(MAIN.IMPORPROR)) TOTAL_PAGADO, MAIN.NUMPRELIQ, DECODE(NVL(MAIN.CDCOMPRO,0),0,'',DECODE(MAIN.CDMETPAG,'EFT',MAIN.NMTRANSF,'CHK',MAIN.NMCHEQUE,MAIN.CDCOMPRO)) NUM_COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHA FROM (SELECT E.TIPOCAMB, C.NMBONO,D.DSBONO,C.CDTIPBON, E.CDGRUPO,E.CDUNIECO, E.CDRAMO,E.NMPOLIZA,a.cdprovee,E.NMRECIBO,F.SERIERECIBO,G.NMTRANSF,G.CDMETPAG,G.NMCHEQUE,G.CDCOMPRO, F.PMATOTAL,F.PMANETAP,C.PORCEPAG,F.IMPORPROV,F.IMPORPROR,A.NUMPRELIQ,A.FEMOVIMI,E.CDTIPMOV,E.CDRECPAG FROM tsia_movudi A ,tsia_tipmovi a1, BON_TPAGLIQ B, BON_TCONFBON C, BON_TCATBONO D, VBON_DESGLOSE E, tsia_detcom F, MINTPSOFT G WHERE A.cdprovee ='{codigo}' " \
						f"AND A.FEMOVIMI BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdcvemov < 1000 AND a.cdconc = a1.cdconc AND a.cdcvemov = a1.cdcvemov AND a1.swconinm IN ('C','I','R','V','T') AND B.NUMPRELIQ =A.NUMPRELIQ AND B.CDAGPROU = A.cdprovee AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC AND C.NMBONO = B.NMBONO AND D.CDBONO = C.CDBONO AND E.NMBONO= C.NMBONO AND A.cdprovee= E.cdprovee AND E.NMPOLIZA= F.NMPOLIZA AND E.CDUNIECO= F.CDUNIECO AND E.CDRAMO= F.CDRAMO AND E.NMRECIBO= F.NMRECIBO AND B.NUMPRELIQ =G.NUMPRELI (+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) GROUP BY E.TIPOCAMB, C.NMBONO,D.DSBONO,C.CDTIPBON, E.CDGRUPO,E.CDUNIECO, E.CDRAMO,E.NMPOLIZA,a.cdprovee,E.NMRECIBO,F.SERIERECIBO,G.NMTRANSF,G.CDMETPAG,G.NMCHEQUE,G.CDCOMPRO, F.PMATOTAL,F.PMANETAP,C.PORCEPAG,F.IMPORPROV,F.IMPORPROR,A.NUMPRELIQ,A.FEMOVIMI,E.CDTIPMOV,E.CDRECPAG ORDER BY FEMOVIMI ASC) MAIN"
	if clave == 'A':
		if tipo == 'BONO':
			if tabla == 0:
				query = getheaderquery('A',codigo,desde,hasta)
			if tabla == 1:
				query = f"SELECT MAIN.NMBONO,MAIN.DSBONO,MAIN.CDTIPBON, MAIN.CDGRUPO,MAIN.CDUNIECO, MAIN.CDRAMO,MAIN.NMPOLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.cdagente,(SELECT OTVALOR07 FROM TVALOPOL Z WHERE Z.CDUNIECO=MAIN.CDUNIECO AND Z.CDRAMO=MAIN.CDRAMO AND Z.NMPOLIZA=MAIN.NMPOLIZA AND Z.ESTADO='M' AND Z.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL Y WHERE Y.CDUNIECO=Z.CDUNIECO AND Z.CDRAMO=Y.CDRAMO AND Z.NMPOLIZA=Y.NMPOLIZA AND Z.ESTADO=Y.ESTADO)) COMPUTABILIDAD, DECODE(MAIN.TIPOCAMB,1,' ',MAIN.TIPOCAMB), MAIN.NMRECIBO,MAIN.SERIERECIBO,NVL(MAIN.PMATOTAL,0) PRIMA_TOTAL,NVL(MAIN.PMANETAP,0) PRIMA_NETA,MAIN.PORCEPAG, ABS(MAIN.IMPORAGTN),(ABS(MAIN.IMPORAGTN)+ABS(MAIN.IMPORAGTI)) TOTAL_PAGADO ,MAIN.NUMPRELIQ, DECODE(NVL(MAIN.CDCOMPRO,0),0,'',DECODE(MAIN.CDMETPAG,'EFT',MAIN.NMTRANSF,'CHK',MAIN.NMCHEQUE,MAIN.CDCOMPRO)) NUM_COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHA, (DECODE ((SELECT DISTINCT 'SI' FROM bon_trecexc WHERE nmbono = MAIN.nmbono AND cdrecpag = MAIN.cdrecpag " \
						f"AND cdagente = MAIN.cdagente AND cdtipmov = MAIN.cdtipmov),'SI', 'SI', 'NO' )) EXCLUDO, (SELECT DECODE(swexcep, '1', 'Por agente para Rank', '2', 'Por agente para Pago', '3', 'Por agente para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 1) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_AGENTE, (SELECT DECODE(swexcep, '1', 'Por promotor para Rank', '2', 'Por promotor para Pago', '3', 'Por promotor para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 2) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_PROMOTOR, (SELECT DECODE(swexcep, '1', 'Por ramo para Rank', '2', 'Por ramo para Pago', '3', 'Por ramo para Todo') FROM bon_trecexc aa, " \
						f"(SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 4) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_RAMO, (SELECT DECODE(swexcep, '1', 'Por oficina para Rank', '2', 'Por oficina para Pago', '3', 'Por oficina para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 5) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov) POR_OFICINA, (SELECT DECODE(swexcep,'1', 'Por poliza para Rank', '2', 'Por poliza para Pago', '3', 'Por poliza para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 6) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) " \
						f"POR_POLIZA, (SELECT DECODE(swexcep, '1', 'Por grupo para Rank', '2', 'Por grupo para Pago', '3', 'Por grupo para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 7) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_GRUPO, (SELECT DECODE(swexcep, '1', 'Por subgrupo para Rank', '2', 'Por subgrupo para Pago', '3', 'Por subgrupo para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 8) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov) POR_SUBGRUPO, (SELECT DECODE(swexcep, '1', 'Por tipo de persona para Rank', '2', 'Por tipo de persona para Pago', '3', 'Por tipo de persona para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 9) bb " \
						f"WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_TIP_PERS, (SELECT DECODE(swexcep, '1', 'Por Reaseguro para Rank', '2', 'Por Reaseguro para Pago', '3', 'Por Reaseguro para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 10) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_REASEGURO, (SELECT DECODE(swexcep, '1', 'Por Coaseguro para Rank', '2', 'Por Coaseguro para Pago', '3', 'Por Coaseguro para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 11) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_COASEGURO, (SELECT DECODE(swexcep, '1', " \
						f"'Por multianual para Rank', '2', 'Por multianual para Pago', '3', 'Por multianual para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 12) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_MULTIANUAL, (SELECT DECODE(swexcep, '1', 'Por dividendos para Rank', '2', 'Por dividendos para Pago', '3', 'Por dividendos para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 13) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_DIVIDENDOS, (SELECT DECODE(swexcep, '1', 'Por no computable para Rank', '2', 'Por no computable para Pago', '3', 'Por no computable para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 14) bb WHERE " \
						f"aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_NO_COMPU, (SELECT DECODE(swexcep, '1', 'Por portafolio para Rank', '2', 'Por portafolio para Pago', '3', 'Por portafolio para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 15) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_PORTAFOLIO, (SELECT DECODE(swexcep, '1', 'Por prestador para Rank', '2', 'Por prestador para Pago', '3', 'Por prestador para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 17) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_PRESTADOR, (SELECT DECODE(swexcep, '1', " \
						f"'Por negocio para Rank', '2', 'Por negocio para Pago', '3', 'Por negocio para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 18) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_NEGOCIO FROM (SELECT E.TIPOCAMB, C.NMBONO,D.DSBONO,C.CDTIPBON, E.CDGRUPO,E.CDUNIECO, E.CDRAMO,E.NMPOLIZA,a.cdagente,E.NMRECIBO,F.SERIERECIBO,G.NMTRANSF,G.CDMETPAG,G.NMCHEQUE,G.CDCOMPRO, F.PMATOTAL,F.PMANETAP,C.PORCEPAG,F.IMPORAGTN,F.IMPORAGTI,A.NUMPRELIQ,A.FEMOVIMI,E.CDTIPMOV,E.CDRECPAG FROM TSIA_MOVAGEN A , BON_TPAGLIQ B, BON_TCONFBON C, BON_TCATBONO D, VBON_DESGLOSE E, tsia_detcom F, MINTPSOFT G WHERE A.CDAGENTE ='{codigo}' AND A.FEMOVIMI BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND A.CDCONC IN ('B','BC') AND B.NUMPRELIQ =A.NUMPRELIQ AND B.CDAGPROU = A.CDAGENTE AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC AND C.NMBONO = B.NMBONO AND " \
						f"D.CDBONO = C.CDBONO AND E.NMBONO= C.NMBONO AND A.CDAGENTE= E.CDAGENTE AND E.NMPOLIZA= F.NMPOLIZA AND E.CDUNIECO= F.CDUNIECO AND E.CDRAMO= F.CDRAMO AND E.NMRECIBO= F.NMRECIBO AND A.CDAGENTE= F.CDAGENTE AND B.NUMPRELIQ =G.NUMPRELI (+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) GROUP BY E.TIPOCAMB,C.NMBONO,D.DSBONO, E.CDGRUPO, E.CDUNIECO, E.CDRAMO,E.NMPOLIZA,a.cdagente, F.SERIERECIBO,G.NMTRANSF,C.CDTIPBON, F.PMATOTAL,F.PMANETAP,G.CDMETPAG,G.NMCHEQUE,G.CDCOMPRO, C.PORCEPAG,F.IMPORAGTN, F.IMPORAGTI,E.CDTIPMOV,E.CDRECPAG, A.NUMPRELIQ,E.NMRECIBO,A.FEMOVIMI ORDER BY FEMOVIMI ASC) MAIN"
		if tipo == 'COMISION':
			if tabla == 0:
				query = getheaderquery('A',codigo,desde,hasta)
			if tabla == 1:
				query = f"select a.tipo, round (nvl(a.HONORARIOS,0),2) base, round (nvl(a.IVA,0),2) iva , round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0),2) Subtotal, round (nvl(a.IVA_RETENIDO,0),2) IVA_RETENIDO, round (nvl(a.ISR,0),2)ISR, round (nvl(a.IMPUESTO_CEDULAR,0),2) IMPUESTO_CEDULAR, round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0)+ nvl(a.IVA_RETENIDO,0) + nvl(a.ISR,0) + nvl(a.IMPUESTO_CEDULAR,0),2) total from ( SELECT a.cdagente, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12," \
						f"to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, " \
						f"(NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE " \
						f"cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND " \
						f"TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente UNION ALL SELECT a.cdagente, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN " \
						f"TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1," \
						f"to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY')," \
						f"'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio " \
						f"FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente ) a"
			if tabla == 2:
				query = f"SELECT a.tipo, round (nvl(a.HONORARIOS,0),2) base, round (nvl(a.IVA,0),2) iva , round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0),2) Subtotal, round (nvl(a.IVA_RETENIDO,0),2) IVA_RETENIDO, round (nvl(a.ISR,0),2)ISR, round (nvl(a.IMPUESTO_CEDULAR,0),2) IMPUESTO_CEDULAR, round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0)+ nvl(a.IVA_RETENIDO,0) + nvl(a.ISR,0) + nvl(a.IMPUESTO_CEDULAR,0),2) total FROM ( SELECT a.cdagente, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP'," \
						f"DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP'," \
						f"DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente UNION ALL SELECT a.cdagente, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' " \
						f"AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < " \
						f"TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND a.femovimi BETWEEN (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente )A"
			if tabla == 3:
				query = f"SELECT CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE FROM ( SELECT A.FEMOVIMI, a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000  AND A.CDCONC NOT IN ('PC') and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' GROUP BY A.FEMOVIMI, a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT A.FEMOVIMI, a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , " \
						f"'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY A.FEMOVIMI, a.cdagente, a.cdmoneda UNION SELECT T.FEMOVIMI, T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.FEMOVIMI, A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, " \
						f"A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.FEMOVIMI, T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.FEMOVIMI, A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' " \
						f"AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 4:
				query = f"SELECT CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE FROM ( SELECT a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 AND A.CDCONC NOT IN ('PC') and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' GROUP BY a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', " \
						f"a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdagente, a.cdmoneda UNION SELECT T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') " \
						f"AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 5:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1,2) AND A.CDMONEDA='MXP' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 6:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'USD' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1,2) AND A.CDMONEDA='USD' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 9:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA='MXP' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 10:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'USD' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA='USD' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 7:
				query = f"SELECT CONCEPTO,SUM(ROUND(nvl(IMPORTE,0),2)) IMPORTE FROM ( SELECT a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND A.CDCONC NOT IN ('PC') AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' GROUP BY a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, " \
						f"'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdagente, a.cdmoneda UNION SELECT T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 8:
				query = f"SELECT CONCEPTO,SUM(ROUND(nvl(IMPORTE,0),2)) IMPORTE FROM ( SELECT a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND A.CDCONC NOT IN ('PC') AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' GROUP BY a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA'," \
						f" a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdagente, a.cdmoneda UNION SELECT T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') " \
						f"AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 11:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDAGENTE AGENTE , B.NUMPRELI NUMPRELI FROM TSIA_MOVAGEN A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) " \
						f"BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDAGENTE = '{codigo}' AND A.CDMONEDA = 'MXP') T GROUP BY T.AGENTE,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
			if tabla == 12:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDAGENTE AGENTE , B.NUMPRELI NUMPRELI FROM TSIA_MOVAGEN A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) " \
						f"BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDAGENTE = '{codigo}' AND A.CDMONEDA = 'USD') T GROUP BY T.AGENTE,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
	if clave == 'P':
		if tipo == 'BONO':
			if tabla == 0:
				query = getheaderquery('P',codigo,desde,hasta)
			if tabla == 1:
				query = f"SELECT MAIN.NMBONO,MAIN.DSBONO,MAIN.CDTIPBON, MAIN.CDGRUPO,MAIN.CDUNIECO, MAIN.CDRAMO,MAIN.NMPOLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.cdagente,(SELECT OTVALOR07 FROM TVALOPOL Z WHERE Z.CDUNIECO=MAIN.CDUNIECO AND Z.CDRAMO=MAIN.CDRAMO AND Z.NMPOLIZA=MAIN.NMPOLIZA AND Z.ESTADO='M' AND Z.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL Y WHERE Y.CDUNIECO=Z.CDUNIECO AND Z.CDRAMO=Y.CDRAMO AND Z.NMPOLIZA=Y.NMPOLIZA AND Z.ESTADO=Y.ESTADO)) COMPUTABILIDAD, DECODE(MAIN.TIPOCAMB,1,' ',MAIN.TIPOCAMB), MAIN.NMRECIBO,MAIN.SERIERECIBO,NVL(MAIN.PMATOTAL,0) PRIMA_TOTAL,NVL(MAIN.PMANETAP,0) PRIMA_NETA,MAIN.PORCEPAG, ABS(MAIN.imporpron),(ABS(MAIN.imporpron)+ABS(MAIN.imporproi)) TOTAL_PAGADO ,MAIN.NUMPRELIQ, DECODE(NVL(MAIN.CDCOMPRO,0),0,'',DECODE(MAIN.CDMETPAG,'EFT',MAIN.NMTRANSF,'CHK',MAIN.NMCHEQUE,MAIN.CDCOMPRO)) NUM_COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHA, (DECODE ((SELECT DISTINCT 'SI' " \
						f"FROM bon_trecexc WHERE nmbono = MAIN.nmbono AND cdrecpag = MAIN.cdrecpag AND cdagente = MAIN.cdagente AND cdtipmov = MAIN.cdtipmov),'SI', 'SI', 'NO' )) EXCLUDO, (SELECT DECODE(swexcep, '1', 'Por agente para Rank', '2', 'Por agente para Pago', '3', 'Por agente para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 1) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_AGENTE, (SELECT DECODE(swexcep, '1', 'Por promotor para Rank', '2', 'Por promotor para Pago', '3', 'Por promotor para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 2) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov " \
						f"AND ROWNUM < 2) POR_PROMOTOR, (SELECT DECODE(swexcep, '1', 'Por ramo para Rank', '2', 'Por ramo para Pago', '3', 'Por ramo para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 4) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_RAMO, (SELECT DECODE(swexcep, '1', 'Por oficina para Rank', '2', 'Por oficina para Pago', '3', 'Por oficina para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 5) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov) POR_OFICINA, (SELECT DECODE(swexcep,'1', 'Por poliza para Rank', '2', 'Por poliza para Pago', '3', 'Por poliza para Todo') FROM bon_trecexc aa, (SELECT codigo, " \
						f"descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 6) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_POLIZA, (SELECT DECODE(swexcep, '1', 'Por grupo para Rank', '2', 'Por grupo para Pago', '3', 'Por grupo para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 7) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_GRUPO, (SELECT DECODE(swexcep, '1', 'Por subgrupo para Rank', '2', 'Por subgrupo para Pago', '3', 'Por subgrupo para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 8) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND " \
						f"aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov) POR_SUBGRUPO, (SELECT DECODE(swexcep, '1', 'Por tipo de persona para Rank', '2', 'Por tipo de persona para Pago', '3', 'Por tipo de persona para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 9) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_TIP_PERS, (SELECT DECODE(swexcep, '1', 'Por Reaseguro para Rank', '2', 'Por Reaseguro para Pago', '3', 'Por Reaseguro para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 10) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_REASEGURO, (SELECT DECODE(swexcep, '1', 'Por Coaseguro para Rank', '2', " \
						f"'Por Coaseguro para Pago', '3', 'Por Coaseguro para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 11) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_COASEGURO, (SELECT DECODE(swexcep, '1', 'Por multianual para Rank', '2', 'Por multianual para Pago', '3', 'Por multianual para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 12) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_MULTIANUAL, (SELECT DECODE(swexcep, '1', 'Por dividendos para Rank', '2', 'Por dividendos para Pago', '3', 'Por dividendos para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' " \
						f"AND codigo = 13) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_DIVIDENDOS, (SELECT DECODE(swexcep, '1', 'Por no computable para Rank', '2', 'Por no computable para Pago', '3', 'Por no computable para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 14) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_NO_COMPU, (SELECT DECODE(swexcep, '1', 'Por portafolio para Rank', '2', 'Por portafolio para Pago', '3', 'Por portafolio para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 15) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente " \
						f"AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_PORTAFOLIO, (SELECT DECODE(swexcep, '1', 'Por prestador para Rank', '2', 'Por prestador para Pago', '3', 'Por prestador para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 17) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_PRESTADOR, (SELECT DECODE(swexcep, '1', 'Por negocio para Rank', '2', 'Por negocio para Pago', '3', 'Por negocio para Todo') FROM bon_trecexc aa, (SELECT codigo, descripl FROM tmanteni WHERE cdtabla = 'CATEXCBON' AND codigo = 18) bb WHERE aa.nmbono = MAIN.nmbono AND aa.cdexcep = bb.codigo AND aa.cdrecpag = MAIN.cdrecpag AND aa.cdagente = MAIN.cdagente AND aa.cdtipmov = MAIN.cdtipmov AND ROWNUM < 2) POR_NEGOCIO FROM (SELECT E.TIPOCAMB, C.NMBONO,D.DSBONO,C.CDTIPBON, E.CDGRUPO,E.CDUNIECO, E.CDRAMO,E.NMPOLIZA,F.CDAGENTE," \
						f"E.NMRECIBO,F.SERIERECIBO,G.NMTRANSF,G.CDMETPAG,G.NMCHEQUE,G.CDCOMPRO, F.PMATOTAL,F.PMANETAP,C.PORCEPAG,F.imporpron,F.imporproi,A.NUMPRELIQ,A.FEMOVIMI,E.CDTIPMOV,E.CDRECPAG FROM TSIA_MOVPROM A , BON_TPAGLIQ B, BON_TCONFBON C, BON_TCATBONO D, VBON_DESGLOSE E, tsia_detcom F, MINTPSOFT G WHERE A.cdpromot ='{codigo}' AND A.FEMOVIMI BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND A.CDCONC IN ('B','BC') AND B.NUMPRELIQ =A.NUMPRELIQ AND B.CDAGPROU = A.cdpromot AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC AND C.NMBONO = B.NMBONO AND D.CDBONO = C.CDBONO AND E.NMBONO= C.NMBONO AND A.cdpromot= E.cdpromot AND E.NMPOLIZA= F.NMPOLIZA AND E.CDUNIECO= F.CDUNIECO AND E.CDRAMO= F.CDRAMO AND E.NMRECIBO= F.NMRECIBO AND A.cdpromot= F.cdpromot AND B.NUMPRELIQ =G.NUMPRELI (+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) GROUP BY E.TIPOCAMB,C.NMBONO,D.DSBONO, E.CDGRUPO, E.CDUNIECO, E.CDRAMO,E.NMPOLIZA,F.CDAGENTE, F.SERIERECIBO,G.NMTRANSF,C.CDTIPBON, " \
						f"F.PMATOTAL,F.PMANETAP,G.CDMETPAG,G.NMCHEQUE,G.CDCOMPRO, C.PORCEPAG,F.imporpron, F.imporproi,E.CDTIPMOV,E.CDRECPAG, A.NUMPRELIQ,E.NMRECIBO,A.FEMOVIMI ORDER BY FEMOVIMI ASC) MAIN"
		if tipo == 'COMISION':
			if tabla == 0:
				query = getheaderquery('P',codigo,desde,hasta)
			if tabla == 1:
				query = f"SELECT TIPO, ROUND(HONORARIOS,2) base, round (IVA,2) iva , round (HONORARIOS + IVA,2) Subtotal, round (IVA_RETENIDO,2) IVA_RETENIDO, round (ISR,2) ISR, round (IMPUESTO_CEDULAR,2) IMPUESTO_CEDULAR, round (HONORARIOS + IVA+ IVA_RETENIDO + ISR + IMPUESTO_CEDULAR,2) total FROM( SELECT a.cdpromot, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}'," \
						f"'DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD'," \
						f"DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM " \
						f"tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')," \
						f"'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot UNION ALL SELECT a.cdpromot, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) " \
						f"BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1," \
						f"to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'))," \
						f"'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios " \
						f"WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot)"
			if tabla == 2:
				query = f"SELECT TIPO, ROUND(HONORARIOS,2) base, round (IVA,2) iva , round (HONORARIOS + IVA,2) Subtotal, round (IVA_RETENIDO,2) IVA_RETENIDO, round (ISR,2) ISR, round (IMPUESTO_CEDULAR,2) IMPUESTO_CEDULAR, round (HONORARIOS + IVA+ IVA_RETENIDO + ISR + IMPUESTO_CEDULAR,2) total FROM(SELECT a.cdpromot, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I'," \
						f"NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc " \
						f"AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot UNION ALL SELECT a.cdpromot, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD'," \
						f"DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND " \
						f"a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot )"
			if tabla == 3:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{codigo}' AND a.CDMONEDA='MXP' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', " \
						f"a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 /* Para daños*/ AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') " \
						f"AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 4:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND " \
						f"b.afedocta = 'S' AND a.cdcvemov < 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{codigo}' AND a.CDMONEDA='USD' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC'," \
						f" a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 /* Para daños*/ AND A.CDPROMOT = '{clave}' AND a.CDMONEDA='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 5:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI ) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') " \
						f"FECHACORTE FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO,ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1,2) AND A.CDMONEDA='MXP' AND A.CDPROMOT='{codigo}') MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 6:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI ) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') " \
						f"FECHACORTE FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO,ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1,2) AND A.CDMONEDA='USD' AND A.CDPROMOT='{codigo}') MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 9:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') " \
						f"FECHACORTE FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO,ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA='MXP' AND A.CDPROMOT='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 10:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = MAIN.CDMONEDA AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'MM'),12,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE(MAIN.femovimi,'DD/MM/YYYY'),'YYYY')),'DDMMYYYY'))) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI) NUMPRELI, (SELECT DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.cdpromot=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') " \
						f"FECHACORTE FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO,ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA='USD' AND A.CDPROMOT='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 7:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov >= 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{hasta}' AND a.CDMONEDA='MXP' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, " \
						f"SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov >= 1000  AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b " \
						f"WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 8:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc " \
						f"AND b.afedocta = 'S' AND a.cdcvemov >= 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{codigo}' AND a.CDMONEDA='USD' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', " \
						f"a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov >= 1000 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 11:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDPROMOT PROMOTOR , B.NUMPRELI NUMPRELI FROM TSIA_MOVPROM A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDPROMOT = '{codigo}' AND A.CDMONEDA = 'MXP') T GROUP BY T.PROMOTOR,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
			if tabla == 12:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDPROMOT PROMOTOR , B.NUMPRELI NUMPRELI FROM TSIA_MOVPROM A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDPROMOT = '{codigo}' AND A.CDMONEDA = 'USD') T GROUP BY T.PROMOTOR,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
	return query


def getheaderquery(clave,codigo,desde,hasta):
	str= ""
	if clave == 'A':
		str = f"SELECT DISTINCT d.dsnombre Nombre, a.cdagente Clave, d.cdideper RFC, e.dsdomici||', '||h.dsprovin||', '||f.dscoloni||', '||j.dsmunici||DECODE(e.cdpostal,NULL,NULL,', C.P. '||e.cdpostal) DIRECCION, 'Agente' Tipo_Productor, b.cdpromot||' - '||c.dspromot PROMOTORIA, a.cdagente Clave_Agente, LPAD(SUBSTR(PKG_Alea_Algoritmos_Cob.fr_Recup_CLABE(a.cdagente),-4),12,'*') CUENTA_CLABE, TO_CHAR(SYSDATE,'DD/MM/YYYY') PERIODO_CORTE, '{desde}' FEINICIO, '{hasta}' FEFIN, TO_CHAR((SELECT Min(feenvio) FROM tsia_movagen A ,BON_TPAGLIQ B WHERE B.NUMPRELIQ =A.NUMPRELIQ AND b.FEENVIO BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdagente= '{codigo}' AND B.CDAGPROU = A.CDAGENTE AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC ),'DD/MM/YYYY') FECHA_PRELIQ FROM tsia_movagen a, tsia_catagt b, tsia_promotor c, mpersona d,mdomicil e,tcolonia f,tmanteni g,tprovin h,tcodipos i,tmunici j WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','DD/MM/YYYY') AND TO_DATE('{hasta}','DD/MM/YYYY') AND a.cdagente = '{codigo}' AND a.cdagente = b.cdagente AND b.cdpromot = c.cdpromot AND b.cdperson = d.cdperson AND d.cdperson = e.cdperson AND e.nmorddom = 1 AND e.cdcoloni = f.cdcoloni AND g.cdtabla = 'TPAISES' AND g.codigo = e.cdpais AND h.cdprovin = j.cdprovin AND a.ptimport <> 0 AND i.cdcodpos = e.cdpostal and j.cdprovin = i.cdprovin and j.cdmunici = i.cdmunici"
	if clave == 'P':
		str = f"SELECT DISTINCT d.dsnombre Nombre, a.cdpromot Clave, d.cdideper RFC, e.dsdomici||', '||h.dsprovin||', '||f.dscoloni||', '||j.dsmunici||'. '||h.dsprovin||DECODE(e.cdpostal,NULL,NULL,', C.P. '||e.cdpostal) DIRECCION, 'Promotor' Tipo_Productor, ' ' PROMOTORIA, a.cdpromot Clave_Agente, LPAD(SUBSTR((SELECT clabe FROM rsa_mcuentas WHERE cdperson=c.cdperson and NMORDCTA=1 UNION SELECT cuenta FROM rsa_mctaint WHERE cdperson = c.cdperson AND NMORDCTA=1),-4),12,'*')  cuenta_bancaria, TO_CHAR(SYSDATE,'DD/MM/YYYY') PERIODO_CORTE, '{desde}' FEINICIO, '{hasta}' FEFIN, TO_CHAR((SELECT Min(feenvio) FROM tsia_movprom A ,BON_TPAGLIQ B WHERE B.NUMPRELIQ =A.NUMPRELIQ AND b.FEENVIO BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdpromot= '{codigo}' AND B.CDAGPROU = A.cdpromot AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC ),'DD/MM/YYYY') FECHA_PRELIQ FROM tsia_movprom a, tsia_promotor c, mpersona d, mdomicil e ,tcolonia f,tmanteni g,tprovin h,tcodipos i,tmunici j WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','DD/MM/YYYY') AND TO_DATE('{hasta}','DD/MM/YYYY') AND a.cdpromot = '{codigo}' AND a.cdpromot = c.cdpromot AND c.cdperson = d.cdperson AND d.cdperson = e.cdperson AND e.nmorddom = 1 AND e.cdcoloni = f.cdcoloni AND g.cdtabla = 'TPAISES' AND g.codigo = e.cdpais AND h.cdprovin = j.cdprovin AND a.ptimport <> 0 AND i.cdcodpos = e.cdpostal and j.cdprovin = i.cdprovin and j.cdmunici = i.cdmunici"
	if clave=='UDI':
		str = f"SELECT DISTINCT d.dsnombre Nombre, a.cdprovee Clave, d.cdideper RFC, e.dsdomici||', '||h.dsprovin||', '||f.dscoloni||', '||j.dsmunici||'. '||h.dsprovin||DECODE(e.cdpostal,NULL,NULL,', C.P. '||e.cdpostal) DIRECCION, 'Proveedor de Servicio' Tipo_Productor, ' ' PROMOTORIA, c.CVE_AGENTE Clave_Agente, LPAD(SUBSTR((SELECT clabe FROM rsa_mcuentas WHERE cdperson=c.cdperson and NMORDCTA=1 UNION SELECT cuenta FROM rsa_mctaint WHERE cdperson = c.cdperson AND NMORDCTA=1),-4),12,'*')  cuenta_bancaria, TO_CHAR(SYSDATE,'DD/MM/YYYY') PERIODO_CORTE, '{desde}' FEINICIO, '{hasta}' FEFIN, TO_CHAR((SELECT Min(feenvio) FROM tsia_movudi A ,BON_TPAGLIQ B WHERE B.NUMPRELIQ =A.NUMPRELIQ AND b.FEENVIO BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdprovee= '{codigo}' AND B.CDAGPROU = A.cdprovee AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC ),'DD/MM/YYYY') FECHA_PRELIQ FROM tsia_movudi a, tsia_udi c, mpersona d, mdomicil e,tcolonia f,tmanteni g,tprovin h,tcodipos i,tmunici j WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','DD/MM/YYYY') AND TO_DATE('{hasta}','DD/MM/YYYY') AND a.cdprovee = '{codigo}' AND a.cdprovee = c.cdprovee AND c.cdperson = d.cdperson AND d.cdperson = e.cdperson AND e.nmorddom = 1 AND e.cdcoloni = f.cdcoloni AND g.cdtabla = 'TPAISES' AND g.codigo = e.cdpais AND h.cdprovin = j.cdprovin AND a.ptimport <> 0 AND i.cdcodpos = e.cdpostal and j.cdprovin = i.cdprovin and j.cdmunici = i.cdmunici"
	return str

def getheaderpdf(tipo,lista_aux,reporte):
	identificador = "Agente"
	if tipo == 'P':
		identificador = "Promotor"
	if tipo == 'UDI':
		identificador = "Prestador de servicio"
	return [("   ", "   ", " ", "   ", "   "),
				("Nombre del SAT para Sura:", "Seguros SURA S.A. de C.V", "     ", f"Nombre del {identificador}:", lista_aux[0]),
				("RFC de Sura:", "R.F.C R&S-811221KR6", "   ", f"Clave del {identificador}:", lista_aux[1]),
				("Domicilio Sura:", "Blvd. Adolfo López Mateos No. 2448", "   ", f"RFC del {identificador}:", lista_aux[2]),
				(" ", "Col. Altavista C.P. 01060 Ciudad de México.", "   ", f"Domicilio del {identificador}:", lista_aux[3]),
				("Periodo de corte:", " ", "   ", "Tipo de productor:", lista_aux[4]),
				("Desde:", lista_aux[9], "   ", "Promotoría a la que pertenece:", lista_aux[5]),
				("Hasta:", lista_aux[10], "   ", "Clave de productor:", lista_aux[6]),
				("Fecha de Preliquidación:", lista_aux[11], "   ", "Cuenta bancaria dada de alta:", lista_aux[7]),
				("   ", "   ", "   ", "   ", "   ")]

def getcolumnstosum(c_count):
	if c_count in [5, 6, 9, 10]:
		return [8,9,11,12,13]
	if c_count in [1, 2]:
		return [1,2,3,4,5,6,7]
	if c_count in [11, 12]:
		return [1,2,3,6,7,8]
	return 0


def getheaderforcompressed(lista,listab):
	listaresp = []
	len_lista=len(lista)
	len_listab=len(listab)
	mayor = len_lista
	if len_listab>len_lista:
		mayor=len_listab
	for i in range(mayor):
		if i<len_lista:
			vaux=lista[i][0]
			if vaux not in listaresp:
				listaresp.append(vaux)
		if i < len_listab:
			vaux = listab[i][0]
			if vaux not in listaresp:
				listaresp.append(vaux)
	listaresp[0]= 'Moneda'
	return listaresp