from reportlab.lib import colors
from reportlab.platypus import TableStyle


def getHeadColumnsBonos(extension,tipo):
	lista = []
	if tipo in ['A','P']:
		lista.append('# Bono')
		lista.append('Tipo Bono')
		lista.append('Subtipo Bono')
		lista.append('Grupo')
		lista.append('Oficina')
		lista.append('Ramo')
		lista.append('Póliza')
		lista.append('Contratante')
		lista.append('Agentes')
		lista.append('Computabilidad')
		if extension == "excel":
			lista.append('Causa de No Computabilidad')
		lista.append('Tipo Cambio')
		lista.append('# Recibo')
		lista.append('Serie')
		lista.append('Prima Total')
		lista.append('Prima Neta')
		lista.append('% Bono Pagado')
		lista.append('Monto comisión neta')
		lista.append('Total comisión pagada')
		#lista.append('# Liquidación')
		#lista.append('# Comprobante')
		lista.append('Fecha aplicación de la póliza')
	return lista


def getHeadColumnsUDI(extension,cursor):
	lista = []
	if cursor in [1, 2]:
		lista.append('Tipo')
		lista.append('IVA')
		lista.append('IVA Retenido')
		lista.append('Subtotal')
		lista.append('ISR')
		lista.append('Impuesto Cedular')
		lista.append('Honorarios')
		lista.append('Total')
	if cursor in [3, 4]:
		lista.append('CONCEPTO')
		lista.append('IMPORTE')
	if cursor in [7]:
		lista.append('Fecha de movimiento')
		lista.append('Daños')
		lista.append('Vida')
		lista.append('Total')
	if cursor in [5, 6]:
		lista.append('# Bono')
		lista.append('Tipo Bono')
		lista.append('Subtipo Bono')
		lista.append('Grupo')
		lista.append('Subgrupo')
		lista.append('Oficina')
		lista.append('Ramo')
		lista.append('Póliza')
		lista.append('Prestador')
		lista.append('Contratante')
		lista.append('Tipo de Cambio')
		lista.append('Recibo')
		lista.append('Prima Total')
		lista.append('Prima Neta')
		lista.append('Prima Convertida')
		lista.append('% Pago Prest. Servicio')
		lista.append('Monto Comisión Neta')
		lista.append('Total Comisión pagado')
		#lista.append('# Liquidación')
		#lista.append('# Comprobante')
		lista.append('Fecha aplicación')
	return lista


def getHeadColumnsComisones(extension,cursor):
	lista = []
	if cursor in [1,2]:
		lista.append("TIPO")
		lista.append("BASE")
		lista.append("IVA")
		lista.append("SUBTOTAL")
		lista.append("IVARETENIDO")
		lista.append("ISR")
		lista.append("IMP. CEDULAR")
		lista.append("TOTAL")
		return lista
	if cursor in [3,4,7,8]:
		lista.append("CONCEPTO")
		lista.append("IMPORTE")
		return lista

	if cursor in [5,6,9,10]:
		if extension == "excel":
			lista.append("Daños/Vida")
			lista.append("Grupo")
		lista.append("Oficina")
		lista.append("Ramo")
		lista.append("Póliza")
		lista.append("Contratante")
		lista.append("Clave Agente")
		lista.append("Tipo de Cambio")
		lista.append("# Recibo")
		lista.append("Serie de Recibo")
		lista.append("Prima Total")
		lista.append("Prima Neta")
		lista.append("% Comisión pagado")
		lista.append("% Comisión de derecho")
		lista.append("Monto Comisión Neta")
		lista.append("Total Comisión pagado")
		lista.append("# Liquidación")
		lista.append("# Comprobante")
		lista.append("Fecha aplicación de la póliza")
		return lista

	if cursor in [11,12]:
		lista.append("FECHA DE LIQUIDACIÓN")
		lista.append("DAÑOS")
		lista.append("VIDA")
		lista.append("TOTAL")
		lista.append("FECHA DE PAGO")
		lista.append("NUMERO DE COMPROBANTE")
		lista.append("IMPORTEPAGADO DAÑOS")
		lista.append("IMPORTE PAGADO VIDA")
		lista.append("TOTAL")
		return lista
	return lista


def getTipoSubBono(id):
	codigo=""
	if id == 20:
		return "BS"
	if id == 30:
		return "BC"
	if id == 40:
		return "BP"
	if id == 50:
		return "BSE"
	if id == 60:
		return "BCS"
	if id == 70:
		return "BPS"
	if id == 80:
		return "BPF"
	if id == 82:
		return "BD"
	return codigo

def getTableNamesUDI(tabla):
	nombre= ""
	if tabla == 1:
		return "TOTAL DE PERCEPCIONES MENSUALES"
	if tabla == 2:
		return "TOTAL DE PERCEPCIONES MENSUALES"
	if tabla == 3:
		return "CONCEPTOS DE DAÑO/VIDA"
	if tabla == 5:
		return "DETALLE DAÑO"
	if tabla == 4:
		return "CONCEPTOS DE DAÑO/VIDA"
	if tabla == 6:
		return "DETALLE VIDA"
	if tabla == 7:
		return "RESUMEN DE DEPÓSITOS MXP"
	return nombre


def getTableNamesComisiones(tabla):
	nombre=[]
	if tabla == 1:
		return "TOTAL DE PERCEPCIONES MENSUALES"
	if tabla == 2:
		return "TOTAL DE PERCEPCIONES ACUMULADO ANUAL"
	if tabla in [3,4]:
		return "CONCEPTOS DE DAÑOS"
	if tabla in [5]:
		return "DAÑOS MONEDA MXP"
	if tabla in [6]:
		return "DAÑOS MONEDA USD"
	if tabla in [9]:
		return "VIDA MONEDA MXP"
	if tabla in [10]:
		return "VIDA MONEDA USD"
	if tabla in [7,8]:
		return "CONCEPTOS DE VIDA"
	if tabla == 11:
		return "RESUMEN DE DEPÓSITOS EN MXP"
	if tabla == 12:
		return "RESUMEN DE DEPÓSITOS EN USD"
	return nombre


def getquery(clave,tipo,tabla,codigo,desde,hasta):
	query = ""
	if clave == 'UDI':
		if tabla == 0:
			query = getheaderquery('UDI', codigo, desde, hasta)
		if tabla == 1:
			query = f"SELECT TIPO,IVA,IVA_RETENIDO,(IVA+IVA_RETENIDO) CF_SUBTOTAL, ISR,IMPUESTO_CEDULAR,HONORARIOS, ((IVA+IVA_RETENIDO)+ISR+IMPUESTO_CEDULAR+HONORARIOS) CF_TOTAL FROM( SELECT A.CDPROVEE cdpromot, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * " \
					f"(SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) " \
					f"AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, " \
					f"(NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + " \
					f"NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movUDI a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdprovee = '{codigo}' GROUP BY a.cdprovee)"
		if tabla == 2:
			query = f"SELECT TIPO,IVA,IVA_RETENIDO,(IVA+IVA_RETENIDO) CF_SUBTOTAL, ISR, HONORARIOS, ((IVA+IVA_RETENIDO)+ISR+IMPUESTO_CEDULAR+HONORARIOS) CF_TOTAL FROM( SELECT a.cdprovee cdpromot, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T" \
					f" WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND " \
					f"C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT C.PTCAMBIO FROM (SELECT DISTINCT R.FEMOVIMI FEINICIO, MIN(T.FEMOVIMI) - 1 FEFINAL FROM tsia_movudi R, tsia_movudi T " \
					f"WHERE R.cdprovee = '{codigo}' AND R.CDCONC = 'SA' AND R.FEMOVIMI >= (SELECT MAX(U.femovimi) FROM tsia_movudi U WHERE U.cdconc = 'SA' AND U.femovimi < TRUNC(TO_DATE('{hasta}', 'DD-MM-YYYY'), 'YYYY')) AND T.cdprovee = R.cdprovee AND T.CDCVEMOV = R.CDCVEMOV AND T.CDCONC = R.CDCONC AND T.FEMOVIMI > R.FEMOVIMI GROUP BY R.FEMOVIMI) T, TCAMBIOS C WHERE A.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM'))),0) + " \
					f"NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movUDI a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdprovee = '{codigo}' GROUP BY a.cdprovee)"
		if tabla == 5:
			query = f"SELECT XBNO, ( SELECT A.DSBONO FROM BON_TCATBONO A WHERE A.CDBONO =( SELECT CDBONO FROM BON_TCONFBON A WHERE A.NMBONO = XBNO)) DS_BONO, ( SELECT CDTIPBON FROM BON_TCONFBON A WHERE A.NMBONO = XBNO) TIPO_BONO, GRUPO,SBGRUPO, OFICINA, RAMO, POLIZA,'{codigo}' PRESTADOR, nomtomador(OFICINA, RAMO, 'M', POLIZA, 9999999999999999999) CONTRATANTE, DECODE(TIPOCAMB, 1, ' ', TIPOCAMB) TIPO_CAMBIO, RECIBO, nvl(( SELECT PTIMPORT FROM MRECIBO WHERE CDUNIECO = OFICINA AND NMRECIBO = RECIBO), 0) CF_PRIMAREC, CS_COMISIONNETAR,CF_PRIMANETA, CS_COMISIONDERECHOR, ( SELECT SUM(PTIMPORT) FROM TSIA_MOVUDI K WHERE K.NUMPRELIQ = NUMPRELIQUI AND K.CDCONC = 'N') TOT_PRE_IMP, ( SELECT SUM(PTIMPORT) FROM TSIA_MOVUDI K WHERE K.NUMPRELIQ = NUMPRELIQUI) TOT_POST_IMP, " \
					f"femovimiento FECHA FROM ( SELECT a.tipocamb, a.nmbono XBNO, A.CDPROVEE promotorcom, A.CDMONEDA monedadet, TRUNC(A.FEMOVIMI) femovimiento, A.CDUNIECO oficina , A.CDRAMO ramo , A.NMPOLIZA poliza, A.NMRECIBO recibo, cdgrupo grupo, cdsubgrp sbgrupo, A.PRIMA_RECIBO ComisionNeta, A.PRIMA_CONVER IvaComision, A.PRIMA_APLICAR IvaRetenido, A.PRIMA_PAGO IsrComision, A.PORCERAN ComisionDerecho, A.PAGO_BONO IsrComDerecho, A.PAGO_FINAL IvaRetDerecho , 0 IvaDerecho, B.FEINICIO feinicio, B.FEFINAL fefinal, 1000 importerec, TRUNC(SYSDATE) fechabase, SUM(A.PRIMA_RECIBO) CS_COMISIONNETAR, SUM(A.PRIMA_CONVER) CF_PRIMANETA, SUM(A.PORCERAN) CS_COMISIONDERECHOR, SUM(A.PAGO_BONO) CS_ISRCOMDERECHOR, SUM(A.PAGO_FINAL) CS_IVARETDERECHOR, BT.NUMPRELIQ NUMPRELIQUI, A.NMPAGO XPAG FROM VBON_DESGLOSE A , MRECIBO B, bon_tpagliq BT, tsia_movudi TM WHERE bt.saldo = tm.ptimport AND bt.cdconc = tm.cdconc AND bt.cdagprou = tm.cdprovee AND BT.NUMPRELIQ = TM.NUMPRELIQ AND A.CDTIPMOV = 'APL' AND A.CDVIDA = 'D' AND A.NMBONO = BT.NMBONO AND A.NMPAGO = BT.NMPAGO AND BT.STATUSP = 'S' AND trunc(TM.FEMOVIMI) BETWEEN TO_DATE('{desde}', 'dd/mm/yyyy') AND TO_DATE('{hasta}', 'dd/mm/yyyy') AND B.CDUNIECO = A.CDUNIECO AND B.CDRAMO = A.CDRAMO AND B.ESTADO = 'M' AND B.NMPOLIZA = A.NMPOLIZA AND B.NMRECIBO = A.NMRECIBO AND TM.CDPROVEE = '{codigo}' GROUP BY A.NMPAGO, BT.NUMPRELIQ, a.tipocamb, a.nmbono, A.CDPROVEE, A.CDMONEDA, trunc(A.femovimi), A.CDUNIECO, A.CDRAMO, A.NMPOLIZA, A.NMRECIBO, cdgrupo, cdsubgrp, A.PRIMA_RECIBO, A.PRIMA_CONVER, A.PRIMA_APLICAR, A.PRIMA_PAGO, A.PORCERAN, A.PAGO_BONO, A.PAGO_FINAL, B.FEINICIO , B.FEFINAL HAVING SUM(A.PAGO_FINAL) <> 0 ORDER BY 1, 2, 3, 4, 5, 6 )"
		if tabla == 3:
			query = f"SELECT CONCEPTO,IMPORTE FROM ( SELECT a.cdprovee cdpromot1, a.cdmoneda moneda, DECODE(a.cdconc,'PC',1999,a.cdcvemov) movimiento, DECODE(a.cdconc,'PC',1999,a.cdcvemov) movimiento2, decode(a.cdconc,'N','Prestación de Servicios Neta' , 'V','IVA de Prestación de Servicios' , 'Q','IVA RET de Prestación de Servicios', decode(a.cdconc, 'IC','Imp Ced de Prestación de Servicios', 'I','ISR de Prestación de Servicios', 'PC','Pago de Prestación de Servicios', b.dsconc ) ) concepto, DECODE(a.cdconc,'PC',1999,b.numprior) numprior, a.cdconc, SUM(a.ptimport) importe FROM tsia_movudi a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 AND a.cdprovee = '{codigo}' HAVING SUM(a.ptimport) <> 0 GROUP BY a.cdprovee, a.cdmoneda, a.cdcvemov, a.cdconc, b.dsconc, b.numprior, a.cdconc ORDER BY a.cdmoneda, DECODE(a.cdconc,'PC',999,a.cdcvemov), DECODE(a.cdconc,'PC',100,b.numprior) )"
		if tabla == 4:
			query = f"SELECT CONCEPTO1,IMPORTE1 FROM ( SELECT cdprovee cdpromot, a.cdmoneda moneda1, DECODE(a.cdconc,'PC',1999,a.cdcvemov) movimiento1, decode(a.cdconc,'N','Prestación de Servicios Neta' , 'V','IVA de Prestación de Servicios' , 'Q','IVA RET Prestación de Servicios', decode(a.cdconc,'IC','Imp Ced de Prestación de Servicios', 'I','ISR de Prestación de Servicios' , 'PC','Pago de Prestación de Servicios', b.dsconc ) ) concepto1, DECODE(a.cdconc,'PC',1999,b.numprior) numprior1, a.cdconc cdconc1, SUM(a.ptimport) importe1 FROM tsia_movudi a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov > 1000 AND a.cdprovee = '{codigo}' HAVING SUM(a.ptimport) <> 0 GROUP BY a.cdprovee, a.cdmoneda, a.cdcvemov, a.cdconc, b.dsconc, b.numprior, a.cdconc ORDER BY a.cdmoneda, DECODE(a.cdconc,'PC',1999,a.cdcvemov), DECODE(a.cdconc,'PC',1999,b.numprior) )"
		if tabla == 7:
			query = f"SELECT TO_CHAR(FEMOVIMIPC,'DD/MM/YYYY') FEMOVIMIPC, DANIOSPC, VIDAPC, TOTALPC FROM ( SELECT cdprovee promotorpc, cdmoneda monedapc, trunc(femovimi ) femovimipc, SUM(DECODE(cdcvemov,600,ptimport,0)) daniospc, SUM(DECODE(cdcvemov,1600,ptimport,0)) vidapc, SUM(ptimport) totalpc FROM tsia_movudi WHERE cdcvemov IN (600, 1600) AND TRUNC(femovimi) BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND CDPROVEE = '{codigo}' GROUP BY CDPROVEE, cdmoneda, trunc(femovimi) ORDER BY CDPROVEE, cdmoneda,trunc( femovimi))"
		if tabla == 6:
			query = f"SELECT XBNO, ( SELECT A.DSBONO FROM BON_TCATBONO A WHERE A.CDBONO =( SELECT CDBONO FROM BON_TCONFBON A WHERE A.NMBONO = XBNO)) DS_BONO, ( SELECT CDTIPBON FROM BON_TCONFBON A WHERE A.NMBONO = XBNO) TIPO_BONO, grupov GRUPO1,sbgrupov SUBGRUPO1, OFICINA1, RAMO1, POLIZA1,'{codigo}' PRESTADOR1, nomtomador(OFICINA1, RAMO1, 'M', POLIZA1, 9999999999999999999) CONTRATANTE, DECODE(TIPOCAMB, 1, ' ', TIPOCAMB) TIPO_CAMBIO, RECIBO1, ( SELECT PTIMPORT FROM MRECIBO WHERE CDUNIECO = OFICINA1 AND NMRECIBO = RECIBO1) CF_PRIMAREC1, CS_COMISIONNETAR1,CF_PRIMANETA1, CS_COMISIONDERECHOR1, ( SELECT SUM(PTIMPORT) FROM TSIA_MOVUDI K WHERE K.NUMPRELIQ = NUMPRELIQUI AND K.CDCONC = 'N') TOT_PRE_IMP, ( SELECT SUM(PTIMPORT) FROM TSIA_MOVUDI K WHERE K.NUMPRELIQ = NUMPRELIQUI) TOT_POST_IMP, " \
					f" FEMOVIMI1 FECHA FROM ( SELECT a.tipocamb, a.nmbono XBNO, A.CDPROVEE promotorcom1, A.CDMONEDA monedadet1, TRUNC(A.FEMOVIMI) femovimi1, A.CDUNIECO oficina1 , A.CDRAMO ramo1 , A.NMPOLIZA poliza1, A.NMRECIBO recibo1, cdgrupo grupov, cdsubgrp sbgrupov, A.PRIMA_RECIBO ComisionNeta1, A.PRIMA_CONVER IvaComision1, A.PRIMA_APLICAR IvaRetenido1, A.PRIMA_PAGO IsrComision1, A.PORCERAN ComisionDerecho1, A.PAGO_BONO IsrComDerecho1, A.PAGO_FINAL IvaRetDerecho1 , 0 IvaDerecho1, B.FEINICIO feinicio, B.FEFINAL fefinal1, 1000 importerec1, TRUNC(SYSDATE) fechabase1, SUM(A.PRIMA_RECIBO) CS_COMISIONNETAR1, SUM(A.PRIMA_CONVER) CF_PRIMANETA1, SUM(A.PORCERAN) CS_COMISIONDERECHOR1, SUM(A.PAGO_BONO) CS_ISRCOMDERECHOR1, SUM(A.PAGO_FINAL) CS_IVARETDERECHOR1, BT.NUMPRELIQ NUMPRELIQUI, A.NMPAGO XPAG FROM VBON_DESGLOSE A , MRECIBO B, bon_tpagliq BT, tsia_movudi TM WHERE bt.saldo = tm.ptimport AND bt.cdconc = tm.cdconc AND bt.cdagprou = tm.cdprovee AND BT.NUMPRELIQ = TM.NUMPRELIQ AND A.CDTIPMOV = 'APL' AND A.CDVIDA = 'V' AND A.NMBONO = BT.NMBONO AND A.NMPAGO = BT.NMPAGO AND BT.STATUSP = 'S' AND TM.FEMOVIMI BETWEEN TO_DATE('{desde}', 'dd/mm/yyyy') AND TO_DATE('{hasta}', 'dd/mm/yyyy') AND B.CDUNIECO = A.CDUNIECO AND B.CDRAMO = A.CDRAMO AND B.ESTADO = 'M' AND B.NMPOLIZA = A.NMPOLIZA AND B.NMRECIBO = A.NMRECIBO AND TM.CDPROVEE = '{codigo}' GROUP BY A.NMPAGO, BT.NUMPRELIQ, a.tipocamb, a.nmbono, A.CDPROVEE, A.CDMONEDA, A.femovimi, A.CDUNIECO, A.CDRAMO, A.NMPOLIZA, A.NMRECIBO, cdgrupo, cdsubgrp, A.PRIMA_RECIBO, A.PRIMA_CONVER, A.PRIMA_APLICAR, A.PRIMA_PAGO, A.PORCERAN, A.PAGO_BONO, A.PAGO_FINAL, B.FEINICIO , B.FEFINAL HAVING SUM(A.PAGO_FINAL) <> 0 ORDER BY 1, 2, 3, 4, 5, 6)"
	if clave == 'A':
		if tipo == 'BONO':
			if tabla == 0:
				query = getheaderquery('A',codigo,desde,hasta)
		if tipo == 'COMISION':
			if tabla == 0:
				query = getheaderquery('A',codigo,desde,hasta)
			if tabla == 1:
				query = f"select a.tipo, round (nvl(a.HONORARIOS,0),2) base, round (nvl(a.IVA,0),2) iva , round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0),2) Subtotal, round (nvl(a.IVA_RETENIDO,0),2) IVA_RETENIDO, round (nvl(a.ISR,0),2)ISR, round (nvl(a.IMPUESTO_CEDULAR,0),2) IMPUESTO_CEDULAR, round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0)+ nvl(a.IVA_RETENIDO,0) + nvl(a.ISR,0) + nvl(a.IMPUESTO_CEDULAR,0),2) total from ( SELECT a.cdagente, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12," \
						f"to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, " \
						f"(NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE " \
						f"cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND " \
						f"TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente UNION ALL SELECT a.cdagente, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN " \
						f"TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1," \
						f"to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY')," \
						f"'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio " \
						f"FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente ) a"
			if tabla == 2:
				query = f"SELECT a.tipo, round (nvl(a.HONORARIOS,0),2) base, round (nvl(a.IVA,0),2) iva , round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0),2) Subtotal, round (nvl(a.IVA_RETENIDO,0),2) IVA_RETENIDO, round (nvl(a.ISR,0),2)ISR, round (nvl(a.IMPUESTO_CEDULAR,0),2) IMPUESTO_CEDULAR, round (nvl(a.HONORARIOS,0) + nvl(a.IVA,0)+ nvl(a.IVA_RETENIDO,0) + nvl(a.ISR,0) + nvl(a.IMPUESTO_CEDULAR,0),2) total FROM ( SELECT a.cdagente, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP'," \
						f"DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP'," \
						f"DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente UNION ALL SELECT a.cdagente, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' " \
						f"AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDAGENTE, 'A', (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < " \
						f"TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movagen a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND a.femovimi BETWEEN (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') and A.CDAGENTE='{codigo}' GROUP BY a.cdagente )A"
			if tabla == 3:
				query = f"SELECT CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE FROM ( SELECT A.FEMOVIMI, a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000  AND A.CDCONC NOT IN ('PC') and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' GROUP BY A.FEMOVIMI, a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT A.FEMOVIMI, a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , " \
						f"'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY A.FEMOVIMI, a.cdagente, a.cdmoneda UNION SELECT T.FEMOVIMI, T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.FEMOVIMI, A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, " \
						f"A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.FEMOVIMI, T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.FEMOVIMI, A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' " \
						f"AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 4:
				query = f"SELECT CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE FROM ( SELECT a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 AND A.CDCONC NOT IN ('PC') and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' GROUP BY a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', " \
						f"a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdagente, a.cdmoneda UNION SELECT T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') " \
						f"AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 5:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, ' ' tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT distinct DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1,2) AND A.CDMONEDA='MXP' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 6:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT C.PTCAMBIO FROM (SELECT DISTINCT A.FEMOVIMI FEINICIO, MIN(B.FEMOVIMI) - 1 FEFINAL FROM TSIA_MOVAGEN A, TSIA_MOVAGEN B WHERE A.CDAGENTE = '{codigo}' AND A.CDCONC = 'SA' AND A.FEMOVIMI >= (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND B.CDAGENTE = A.CDAGENTE AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC AND B.FEMOVIMI > A.FEMOVIMI GROUP BY A.FEMOVIMI) T, TCAMBIOS C WHERE MAIN.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM')) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA='MXP' AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT distinct DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA='MXP' AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1,2) AND A.CDMONEDA='USD' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 9:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, ' ' tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT distinct DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA=MAIN.CDMONEDA AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA='MXP' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 10:
				query = f"SELECT decode(cdtipram,3,'VIDA','DAÑO') TIPO, (SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO=MAIN.CDUNIECO AND A.CDRAMO=MAIN.CDRAMO AND A.ESTADO='M' AND A.NMPOLIZA=MAIN.NMPOLIZA AND A.NMSUPLEM=(SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO=B.CDUNIECO AND A.CDRAMO=B.CDRAMO AND A.ESTADO=B.ESTADO AND A.NMPOLIZA=B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.CDAGENTE, (SELECT C.PTCAMBIO FROM (SELECT DISTINCT A.FEMOVIMI FEINICIO, MIN(B.FEMOVIMI) - 1 FEFINAL FROM TSIA_MOVAGEN A, TSIA_MOVAGEN B WHERE A.CDAGENTE = '{codigo}' AND A.CDCONC = 'SA' AND A.FEMOVIMI >= (SELECT MAX(femovimi) FROM tsia_movagen WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND B.CDAGENTE = A.CDAGENTE AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC AND B.FEMOVIMI > A.FEMOVIMI GROUP BY A.FEMOVIMI) T, TCAMBIOS C WHERE MAIN.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM')) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL,0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta,0) PRIMA_NETA, nvl(MAIN.PORAGEN,0) PORC_COMISION, nvl(MAIN.COM_DERECHO,0) COMISION_DERECHO, nvl(MAIN.COM_NETA,0) COMISION_NETA, (nvl(MAIN.ComisionNeta,0) + nvl(MAIN.IvaComision,0) + nvl(MAIN.IvaRetenido,0)+ nvl(MAIN.IsrComision,0) + nvl(MAIN.ComisionDerecho,0) + nvl(MAIN.IsrComDerecho,0) + nvl(MAIN.IvaRetDerecho,0) + nvl(MAIN.IvaDerecho,0)) TOTAL_COMISION, (SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA='MXP' AND A.CDAGENTE=MAIN.CDAGENTE " \
						f"AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI ) NUMPRELI, (SELECT distinct DECODE(NVL(CDCOMPRO,0),0,'',DECODE(CDMETPAG,'EFT',NMTRANSF,'CHK',NMCHEQUE,CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI=(SELECT min(NUMPRELIQ) FROM TSIA_MOVAGEN A WHERE A.CDMONEDA='MXP' AND A.CDAGENTE=MAIN.CDAGENTE AND A.CDCVEMOV=1600 AND A.CDCONC='PC' AND FEMOVIMI>= MAIN.FEMOVIMI)) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI,'DD/MM/YYYY') FECHACORTE " \
						f"FROM ( SELECT A.CDMONEDA,A.CDAGENTE,c.cdtipram,A.FEMOVIMI, A.CDUNIECO,A.CDRAMO,A.NMPOLIZA,A.NMRECIBO,NVL(A.SERIERECIBO,0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC,A.DSNOMASEG, NVL(A.PMATOTAL,0) PRIMA_TOTAL,a.PMANETAP PrimaNeta, a.IMPORAGTN COM_NETA,a.PORAGEN, NVL(decode(a.SWAPDER,'A',IMPORAGTND,NULL),0) COM_DERECHO, /*SUMATORIAS*/ ROUND(NVL(a.imporagtn,0),2) ComisionNeta, ROUND(NVL(a.imporagtv,0),2) IvaComision, ROUND(NVL(a.imporagtq,0),2) IvaRetenido, ROUND(NVL(a.imporagti,0),2) IsrComision, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtnd,0),0),2) ComisionDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtid,0),0),2) IsrComDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtqd,0),0),2) IvaRetDerecho, ROUND(DECODE(a.swapder,'A',NVL(a.imporagtvd,0),0),2) IvaDerecho from tsia_detcom a, TRAMOS C where TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA='USD' AND A.CDAGENTE='{codigo}' ) MAIN ORDER BY FEMOVIMI, CDUNIECO,CDRAMO,NMPOLIZA,NMRECIBO"
			if tabla == 7:
				query = f"SELECT CONCEPTO,SUM(ROUND(nvl(IMPORTE,0),2)) IMPORTE FROM ( SELECT a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND A.CDCONC NOT IN ('PC') AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' GROUP BY a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, " \
						f"'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdagente, a.cdmoneda UNION SELECT T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 8:
				query = f"SELECT CONCEPTO,SUM(ROUND(nvl(IMPORTE,0),2)) IMPORTE FROM ( SELECT a.cdagente, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND A.CDCONC NOT IN ('PC') AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' GROUP BY a.cdagente, a.cdmoneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) UNION SELECT a.cdagente, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'SB' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA'," \
						f" a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0))) Importe,0 importe2 FROM tsia_movagen a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov > 1000 and A.CDAGENTE='{codigo}' AND a.cdmoneda='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdagente, a.cdmoneda UNION SELECT T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDAGENTE, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') " \
						f"AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDAGENTE, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDAGENTE, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM TSIA_MOVAGEN a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDAGENTE = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 11:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDAGENTE AGENTE , B.NUMPRELI NUMPRELI FROM TSIA_MOVAGEN A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) " \
						f"BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDAGENTE = '{codigo}' AND A.CDMONEDA = 'MXP') T GROUP BY T.AGENTE,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
			if tabla == 12:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDAGENTE AGENTE , B.NUMPRELI NUMPRELI FROM TSIA_MOVAGEN A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) " \
						f"BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDAGENTE = '{codigo}' AND A.CDMONEDA = 'USD') T GROUP BY T.AGENTE,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
	if clave == 'P':
		if tipo == 'BONO':
			if tabla == 0:
				query = getheaderquery('P',codigo,desde,hasta)
		if tipo == 'COMISION':
			if tabla == 0:
				query = getheaderquery('P',codigo,desde,hasta)
			if tabla == 1:
				query = f"SELECT TIPO, ROUND(HONORARIOS,2) base, round (IVA,2) iva , round (HONORARIOS + IVA,2) Subtotal, round (IVA_RETENIDO,2) IVA_RETENIDO, round (ISR,2) ISR, round (IMPUESTO_CEDULAR,2) IMPUESTO_CEDULAR, round (HONORARIOS + IVA+ IVA_RETENIDO + ISR + IMPUESTO_CEDULAR,2) total FROM( SELECT a.cdpromot, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}'," \
						f"'DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD'," \
						f"DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM " \
						f"tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')," \
						f"'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot UNION ALL SELECT a.cdpromot, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) " \
						f"BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1," \
						f"to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'))," \
						f"'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * (SELECT ptcambio FROM tcambios " \
						f"WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) = (SELECT MAX(TRUNC(fevalor)) FROM tcambios WHERE cdmoneda = 'MXP' AND cdmonbas = 'USD' AND TRUNC(fevalor) BETWEEN TO_DATE('01'||LPAD(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),2,0)||to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY'),'DDMMYYYY') AND TO_DATE('01'||LPAD(DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM') + 1),2,0)||DECODE(to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'MM'),12,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY') + 1,to_char(TO_DATE('{hasta}','DD/MM/YYYY'),'YYYY')),'DDMMYYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot)"
			if tabla == 2:
				query = f"SELECT TIPO, ROUND(HONORARIOS,2) base, round (IVA,2) iva , round (HONORARIOS + IVA,2) Subtotal, round (IVA_RETENIDO,2) IVA_RETENIDO, round (ISR,2) ISR, round (IMPUESTO_CEDULAR,2) IMPUESTO_CEDULAR, round (HONORARIOS + IVA+ IVA_RETENIDO + ISR + IMPUESTO_CEDULAR,2) total FROM(SELECT a.cdpromot, 'DAÑOS' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'I'," \
						f"NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov < 1000 AND a.cdconc = b.cdconc " \
						f"AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot UNION ALL SELECT a.cdpromot, 'VIDA' tipo, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'V',NVL(a.ptimport,0),0),0)),0)) IVA, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'R',NVL(a.ptimport,0),0),0)),0)) IVA_RETENIDO, (NVL(SUM(DECODE(a.cdmoneda,'USD'," \
						f"DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'I',NVL(a.ptimport,0),0),0)),0)) ISR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'C',NVL(a.ptimport,0),0),0)),0)) IMPUESTO_CEDULAR, (NVL(SUM(DECODE(a.cdmoneda,'USD',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0) * F_TIPO_CAMBIO(A.FEMOVIMI, A.CDPROMOT, 'P', (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')))),0) + NVL(SUM(DECODE(a.cdmoneda,'MXP',DECODE(b.swconinm,'T',NVL(a.ptimport,0),0),0)),0)) HONORARIOS FROM tsia_movprom a, tsia_tipmovi b WHERE a.cdcvemov >= 1000 AND " \
						f"a.cdconc = b.cdconc AND a.cdcvemov = b.cdcvemov AND b.swconinm IN ('C','I','R','V','T') AND TRUNC(a.femovimi) BETWEEN (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND to_date('{hasta}','dd/mm/yyyy') AND A.CDPROMOT='{codigo}' GROUP BY a.cdpromot )"
			if tabla == 3:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{codigo}' AND a.CDMONEDA='MXP' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', " \
						f"a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 /* Para daños*/ AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') " \
						f"AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 4:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND " \
						f"b.afedocta = 'S' AND a.cdcvemov < 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{codigo}' AND a.CDMONEDA='USD' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC'," \
						f" a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov < 1000 /* Para daños*/ AND A.CDPROMOT = '{clave}' AND a.CDMONEDA='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 5:
				query = f"SELECT decode(cdtipram, 3, 'VIDA', 'DAÑO') TIPO, ( SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO = MAIN.CDUNIECO AND A.CDRAMO = MAIN.CDRAMO AND A.ESTADO = 'M' AND A.NMPOLIZA = MAIN.NMPOLIZA AND A.NMSUPLEM =( SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO = B.CDUNIECO AND A.CDRAMO = B.CDRAMO AND A.ESTADO = B.ESTADO AND A.NMPOLIZA = B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.cdagente, ' ' tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL, 0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta, 0) PRIMA_NETA, nvl(MAIN.PORPROM, 0) PORC_COMISION, nvl(MAIN.COM_DERECHO, 0) COMISION_DERECHO, nvl(MAIN.COM_NETA, 0) COMISION_NETA, (nvl(MAIN.ComisionNeta, 0) + nvl(MAIN.IvaComision, 0) + nvl(MAIN.IvaRetenido, 0)+ nvl(MAIN.IsrComision, 0) + nvl(MAIN.ComisionDerecho, 0) + nvl(MAIN.IsrComDerecho, 0) + nvl(MAIN.IvaRetDerecho, 0) + nvl(MAIN.IvaDerecho, 0)) TOTAL_COMISION, ( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = MAIN.CDMONEDA AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI ) NUMPRELI, ( SELECT DISTINCT DECODE(NVL(CDCOMPRO, 0), 0, '', DECODE(CDMETPAG, 'EFT', NMTRANSF, 'CHK', NMCHEQUE, CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI =( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = MAIN.CDMONEDA AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI, 'DD/MM/YYYY') FECHACORTE FROM ( SELECT A.CDMONEDA, a.cdagente,A.cdpromot, c.cdtipram, A.FEMOVIMI, A.CDUNIECO, A.CDRAMO, A.NMPOLIZA, A.NMRECIBO, NVL(A.SERIERECIBO, 0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC, A.DSNOMASEG, NVL(A.PMATOTAL, 0) PRIMA_TOTAL, NVL(a.PMANETAP, 0) PrimaNeta, NVL(a.IMPORPRON, 0) COM_NETA, NVL(a.PORPROM, 0) PORPROM, NVL(decode(a.SWAPDER, 'P', IMPORAGTND, NULL), 0) COM_DERECHO, round(NVL(a.imporpron, 0), 2) ComisionNeta, round(NVL(a.imporprov, 0), 2) IvaComision, round(NVL(a.imporpror, 0), 2) IvaRetenido, round(NVL(a.imporproi, 0), 2) IsrComision, " \
						f"round(DECODE(a.swapder, 'P', NVL(a.imporagtnd, 0), 0), 2) ComisionDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtid, 0), 0), 2) IsrComDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtqd, 0), 0), 2) IvaRetDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtvd, 0), 0), 2) IvaDerecho FROM tsia_detcom a, TRAMOS C WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}', 'dd/mm/yyyy') AND to_date('{hasta}', 'dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1, 2) AND A.CDMONEDA = 'MXP' AND A.CDPROMOT ='{codigo}') MAIN ORDER BY FEMOVIMI, CDUNIECO, CDRAMO, NMPOLIZA, NMRECIBO"
			if tabla == 6:
				query = f"SELECT decode(cdtipram, 3, 'VIDA', 'DAÑO') TIPO, ( SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO = MAIN.CDUNIECO AND A.CDRAMO = MAIN.CDRAMO AND A.ESTADO = 'M' AND A.NMPOLIZA = MAIN.NMPOLIZA AND A.NMSUPLEM =( SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO = B.CDUNIECO AND A.CDRAMO = B.CDRAMO AND A.ESTADO = B.ESTADO AND A.NMPOLIZA = B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.cdagente,  (SELECT C.PTCAMBIO FROM (SELECT DISTINCT A.FEMOVIMI FEINICIO, MIN(B.FEMOVIMI) - 1 FEFINAL FROM TSIA_MOVPROM A, TSIA_MOVPROM B WHERE A.CDPROMOT = '{codigo}' AND A.CDCONC = 'SA' AND A.FEMOVIMI >= (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND B.CDPROMOT = A.CDPROMOT AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC AND B.FEMOVIMI > A.FEMOVIMI GROUP BY A.FEMOVIMI) T, TCAMBIOS C WHERE MAIN.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM')) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL, 0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta, 0) PRIMA_NETA, nvl(MAIN.PORPROM, 0) PORC_COMISION, nvl(MAIN.COM_DERECHO, 0) COMISION_DERECHO, nvl(MAIN.COM_NETA, 0) COMISION_NETA, (nvl(MAIN.ComisionNeta, 0) + nvl(MAIN.IvaComision, 0) + nvl(MAIN.IvaRetenido, 0)+ nvl(MAIN.IsrComision, 0) + nvl(MAIN.ComisionDerecho, 0) + nvl(MAIN.IsrComDerecho, 0) + nvl(MAIN.IvaRetDerecho, 0) + nvl(MAIN.IvaDerecho, 0)) TOTAL_COMISION, ( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = 'MXP' AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI ) NUMPRELI, ( SELECT DISTINCT DECODE(NVL(CDCOMPRO, 0), 0, '', DECODE(CDMETPAG, 'EFT', NMTRANSF, 'CHK', NMCHEQUE, CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI =( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = 'MXP' AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI, 'DD/MM/YYYY') FECHACORTE FROM ( SELECT A.CDMONEDA,a.cdagente, A.cdpromot, c.cdtipram, A.FEMOVIMI, A.CDUNIECO, A.CDRAMO, A.NMPOLIZA, A.NMRECIBO, NVL(A.SERIERECIBO, 0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC, A.DSNOMASEG, NVL(A.PMATOTAL, 0) PRIMA_TOTAL, NVL(a.PMANETAP, 0) PrimaNeta, NVL(a.IMPORPRON, 0) COM_NETA, NVL(a.PORPROM, 0) PORPROM, NVL(decode(a.SWAPDER, 'P', IMPORAGTND, NULL), 0) COM_DERECHO, round(NVL(a.imporpron, 0), 2) ComisionNeta, round(NVL(a.imporprov, 0), 2) IvaComision, round(NVL(a.imporpror, 0), 2) IvaRetenido, round(NVL(a.imporproi, 0), 2) IsrComision, " \
						f"round(DECODE(a.swapder, 'P', NVL(a.imporagtnd, 0), 0), 2) ComisionDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtid, 0), 0), 2) IsrComDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtqd, 0), 0), 2) IvaRetDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtvd, 0), 0), 2) IvaDerecho FROM tsia_detcom a, TRAMOS C WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}', 'dd/mm/yyyy') AND to_date('{hasta}', 'dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (1, 2) AND A.CDMONEDA = 'USD' AND A.CDPROMOT ='{codigo}') MAIN ORDER BY FEMOVIMI, CDUNIECO, CDRAMO, NMPOLIZA, NMRECIBO"
			if tabla == 9:
				query = f"SELECT decode(cdtipram, 3, 'VIDA', 'DAÑO') TIPO, ( SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO = MAIN.CDUNIECO AND A.CDRAMO = MAIN.CDRAMO AND A.ESTADO = 'M' AND A.NMPOLIZA = MAIN.NMPOLIZA AND A.NMSUPLEM =( SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO = B.CDUNIECO AND A.CDRAMO = B.CDRAMO AND A.ESTADO = B.ESTADO AND A.NMPOLIZA = B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.cdagente, ' ' tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL, 0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta, 0) PRIMA_NETA, nvl(MAIN.PORPROM, 0) PORC_COMISION, nvl(MAIN.COM_DERECHO, 0) COMISION_DERECHO, nvl(MAIN.COM_NETA, 0) COMISION_NETA, (nvl(MAIN.ComisionNeta, 0) + nvl(MAIN.IvaComision, 0) + nvl(MAIN.IvaRetenido, 0)+ nvl(MAIN.IsrComision, 0) + nvl(MAIN.ComisionDerecho, 0) + nvl(MAIN.IsrComDerecho, 0) + nvl(MAIN.IvaRetDerecho, 0) + nvl(MAIN.IvaDerecho, 0)) TOTAL_COMISION, ( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = MAIN.CDMONEDA AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 1600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI ) NUMPRELI, ( SELECT DISTINCT DECODE(NVL(CDCOMPRO, 0), 0, '', DECODE(CDMETPAG, 'EFT', NMTRANSF, 'CHK', NMCHEQUE, CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI =( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = MAIN.CDMONEDA AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 1600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI, 'DD/MM/YYYY') FECHACORTE FROM ( SELECT A.CDMONEDA,a.cdagente, A.cdpromot, c.cdtipram, A.FEMOVIMI, A.CDUNIECO, A.CDRAMO, A.NMPOLIZA, A.NMRECIBO, NVL(A.SERIERECIBO, 0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC, A.DSNOMASEG, NVL(A.PMATOTAL, 0) PRIMA_TOTAL, NVL(a.PMANETAP, 0) PrimaNeta, NVL(a.IMPORPRON, 0) COM_NETA, NVL(a.PORPROM, 0) PORPROM, NVL(decode(a.SWAPDER, 'P', IMPORAGTND, NULL), 0) COM_DERECHO, round(NVL(a.imporpron, 0), 2) ComisionNeta, round(NVL(a.imporprov, 0), 2) IvaComision, round(NVL(a.imporpror, 0), 2) IvaRetenido, round(NVL(a.imporproi, 0), 2) IsrComision, " \
						f"round(DECODE(a.swapder, 'P', NVL(a.imporagtnd, 0), 0), 2) ComisionDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtid, 0), 0), 2) IsrComDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtqd, 0), 0), 2) IvaRetDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtvd, 0), 0), 2) IvaDerecho FROM tsia_detcom a, TRAMOS C WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}', 'dd/mm/yyyy') AND to_date('{hasta}', 'dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA = 'MXP' AND A.CDPROMOT ='{codigo}') MAIN ORDER BY FEMOVIMI, CDUNIECO, CDRAMO, NMPOLIZA, NMRECIBO"
			if tabla == 10:
				query = f"SELECT decode(cdtipram, 3, 'VIDA', 'DAÑO') TIPO, ( SELECT OTVALOR05 FROM TVALOPOL A WHERE A.CDUNIECO = MAIN.CDUNIECO AND A.CDRAMO = MAIN.CDRAMO AND A.ESTADO = 'M' AND A.NMPOLIZA = MAIN.NMPOLIZA AND A.NMSUPLEM =( SELECT MAX(NMSUPLEM) FROM TVALOPOL B WHERE A.CDUNIECO = B.CDUNIECO AND A.CDRAMO = B.CDRAMO AND A.ESTADO = B.ESTADO AND A.NMPOLIZA = B.NMPOLIZA)) grupo, MAIN.CDUNIECO OFICINA, MAIN.CDRAMO RAMO, MAIN.NMPOLIZA POLIZA, nomtomador(MAIN.CDUNIECO, MAIN.CDRAMO, 'M', MAIN.NMPOLIZA, 9999999999999999999) CONTRATANTE, MAIN.cdagente,  (SELECT C.PTCAMBIO FROM (SELECT DISTINCT A.FEMOVIMI FEINICIO, MIN(B.FEMOVIMI) - 1 FEFINAL FROM TSIA_MOVPROM A, TSIA_MOVPROM B WHERE A.CDPROMOT = '{codigo}' AND A.CDCONC = 'SA' AND A.FEMOVIMI >= (SELECT MAX(femovimi) FROM tsia_movprom WHERE cdconc = 'SA' AND femovimi < TRUNC(TO_DATE('{hasta}','DD-MM-YYYY'),'YYYY')) AND B.CDPROMOT = A.CDPROMOT AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC AND B.FEMOVIMI > A.FEMOVIMI GROUP BY A.FEMOVIMI) T, TCAMBIOS C WHERE MAIN.FEMOVIMI BETWEEN T.FEINICIO AND FEFINAL AND C.CDMONEDA = 'MXP' AND C.CDMONBAS = 'USD' AND C.FEVALOR = TRUNC(ADD_MONTHS(T.FEFINAL, 1), 'MM')) tipo_camb, MAIN.NMRECIBO RECIBO, MAIN.SERIERECIBO SERIE_REC, nvl(MAIN.PRIMA_TOTAL, 0) PRIMA_TOTAL, nvl(MAIN.PrimaNeta, 0) PRIMA_NETA, nvl(MAIN.PORPROM, 0) PORC_COMISION, nvl(MAIN.COM_DERECHO, 0) COMISION_DERECHO, nvl(MAIN.COM_NETA, 0) COMISION_NETA, (nvl(MAIN.ComisionNeta, 0) + nvl(MAIN.IvaComision, 0) + nvl(MAIN.IvaRetenido, 0)+ nvl(MAIN.IsrComision, 0) + nvl(MAIN.ComisionDerecho, 0) + nvl(MAIN.IsrComDerecho, 0) + nvl(MAIN.IvaRetDerecho, 0) + nvl(MAIN.IvaDerecho, 0)) TOTAL_COMISION, ( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = 'MXP' AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 1600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI ) NUMPRELI, ( SELECT DISTINCT DECODE(NVL(CDCOMPRO, 0), 0, '', DECODE(CDMETPAG, 'EFT', NMTRANSF, 'CHK', NMCHEQUE, CDCOMPRO)) FROM MINTPSOFT WHERE NUMPRELI =( SELECT min(NUMPRELIQ) FROM tsia_movprom A WHERE A.CDMONEDA = 'MXP' AND A.cdpromot = MAIN.cdpromot AND A.CDCVEMOV = 1600 AND A.CDCONC = 'PC' AND FEMOVIMI >= MAIN.FEMOVIMI )) COMPROBANTE, TO_CHAR(MAIN.FEMOVIMI, 'DD/MM/YYYY') FECHACORTE FROM ( SELECT A.CDMONEDA,a.cdagente, A.cdpromot, c.cdtipram, A.FEMOVIMI, A.CDUNIECO, A.CDRAMO, A.NMPOLIZA, A.NMRECIBO, NVL(A.SERIERECIBO, 0) SERIERECIBO, A.FEINICIOREC, A.FEMOVIMI FEAPLIC, A.DSNOMASEG, NVL(A.PMATOTAL, 0) PRIMA_TOTAL, NVL(a.PMANETAP, 0) PrimaNeta, NVL(a.IMPORPRON, 0) COM_NETA, NVL(a.PORPROM, 0) PORPROM, NVL(decode(a.SWAPDER, 'P', IMPORAGTND, NULL), 0) COM_DERECHO, round(NVL(a.imporpron, 0), 2) ComisionNeta, round(NVL(a.imporprov, 0), 2) IvaComision, round(NVL(a.imporpror, 0), 2) IvaRetenido, round(NVL(a.imporproi, 0), 2) IsrComision, " \
						f"round(DECODE(a.swapder, 'P', NVL(a.imporagtnd, 0), 0), 2) ComisionDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtid, 0), 0), 2) IsrComDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtqd, 0), 0), 2) IvaRetDerecho, round(DECODE(a.swapder, 'P', NVL(a.imporagtvd, 0), 0), 2) IvaDerecho FROM tsia_detcom a, TRAMOS C WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}', 'dd/mm/yyyy') AND to_date('{hasta}', 'dd/mm/yyyy') AND a.cdramo = c.cdramo AND c.cdtipram IN (3) AND A.CDMONEDA = 'USD' AND A.CDPROMOT ='{codigo}') MAIN ORDER BY FEMOVIMI, CDUNIECO, CDRAMO, NMPOLIZA, NMRECIBO"
			if tabla == 7:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov >= 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{hasta}' AND a.CDMONEDA='MXP' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, " \
						f"SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov >= 1000  AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b " \
						f"WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'MXP') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='MXP' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 8:
				query = f"select CONCEPTO,SUM(ROUND(IMPORTE,2)) IMPORTE from(SELECT a.cdpromot, a.cdmoneda moneda, decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) movimiento, decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) concepto, decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) numprior , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) cdconc, SUM(a.ptimport) importe, SUM(a.ptimport) SBimporte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc " \
						f"AND b.afedocta = 'S' AND a.cdcvemov >= 1000 AND A.CDCONC NOT IN ('PC') AND A.CDPROMOT='{codigo}' AND a.CDMONEDA='USD' GROUP BY a.cdpromot, a.cdmoneda,decode(a.cdconc,'QD',22, 'V',2 , 'Q',22, 'VD',2, decode(a.cdconc, 'I',2, 'ID',2 , 'PC',1999, 'B',2, 'IC',607, decode(b.dsconc,'Imp Cedular Derecho',607,a.cdcvemov) ) ) , decode(a.cdconc,'QD','IVA Retenido' , 'V','IVA' , 'Q','IVA Retenido', 'VD','IVA', decode(a.cdconc, 'I','ISR', 'ID','ISR' , 'PC','Pago de Comisión', 'IC','Impuesto Cedular', decode(b.dsconc,'Imp Cedular Derecho','Impuesto Cedular', b.dsconc) ) ) , decode(a.cdconc,'QD',2.1 , 'V',2 , 'Q',2.1, 'VD',2, decode(a.cdconc, 'I',4, 'ID',4 , 'PC',1999, 'B',1.2, 'ND',1,decode(b.dsconc,'Imp Cedular Derecho',6, b.numprior) ) ) , decode(a.cdconc,'QD','Q' , 'V','V' , 'Q','Q', 'VD','V', decode(a.cdconc, 'I','I', 'ID','I' ,decode(b.dsconc,'Imp Cedular Derecho','IC', a.cdconc) )) union SELECT a.cdpromot, a.cdmoneda moneda, 19 movimiento, 'Subtotal' concepto, 1.9 numprior , 'ST' cdconc, SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'CD', " \
						f"a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport, decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)))Importe, 0 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov >= 1000 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='USD' HAVING SUM ( DECODE (a.cdconc, 'N', a.ptimport, 'ND', a.ptimport, 'GA', a.ptimport, 'B', a.ptimport, 'DC', a.ptimport, 'BC', a.ptimport, 'PI', a.ptimport,decode(b.dsconc,'Descuento de Comisión', a.ptimport, 0)) )<> 0 GROUP BY a.cdpromot, a.cdmoneda UNION SELECT T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC, SUM(T.IMPORTE), SUM(T.SBIMPORTE) FROM (SELECT A.CDPROMOT, A.CDMONEDA MONEDA, 1999 MOVIMIENTO, 'Pago de Comisión' CONCEPTO, 1999 numprior, 'PC' CDCONC, A.PTIMPORT IMPORTE, A.PTIMPORT SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov " \
						f"AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA = 'USD') T GROUP BY T.CDPROMOT, T.MONEDA, T.MOVIMIENTO, T.CONCEPTO, T.NUMPRIOR, T.CDCONC UNION SELECT A.CDPROMOT, A.CDMONEDA MONEDA, DECODE(a.cdconc, 'I',2, 'V',2, 'Q',22, 'IC',607, 'PC',1999) MOVIMIENTO, DECODE(a.cdconc, 'I','ISR', 'V','IVA', 'Q','IVA Retenido', 'IC','Impuesto Cedular', 'PC','Pago de Comisión' ) CONCEPTO, DECODE(a.cdconc, 'I',4, 'V',2, 'Q',2.1, 'IC',6, 'PC',1999) numprior, A.CDCONC CDCONC, A.PTIMPORT*-1 IMPORTE, A.PTIMPORT*-1 SBIMPorte FROM tsia_movprom a, tsia_tipmovi b WHERE TRUNC(a.femovimi) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') AND a.cdcvemov = b.cdcvemov AND a.cdconc = b.cdconc AND b.afedocta = 'S' AND a.cdcvemov = 1600 AND a.CDCONC IN ('I','V','Q','IC') AND A.CDPROMOT = '{codigo}' AND a.CDMONEDA='USD' ) GROUP BY NUMPRIOR,MOVIMIENTO,CDCONC,CONCEPTO order by NUMPRIOR,MOVIMIENTO,CDCONC"
			if tabla == 11:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDPROMOT PROMOTOR , B.NUMPRELI NUMPRELI FROM TSIA_MOVPROM A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDPROMOT = '{codigo}' AND A.CDMONEDA = 'MXP') T GROUP BY T.PROMOTOR,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
			if tabla == 12:
				query = f"SELECT T.FECHA_MOVIMIENTO FECHA_MOVIMIENTO , SUM(T.IMPORTE_DANOS) IMPORTE_DANOS , SUM(T.IMPORTE_VIDA) IMPORTE_VIDA , SUM(T.TOTAL) TOTAL , T.FECHA_PAGO FECHA_PAGO , T.NUM_COMPROBANTE NUM_COMPROBANTE , SUM(T.IMPORTE_PAG_DANOS) IMPORTE_PAG_DANOS, SUM(T.IMPORTE_PAG_VIDA) IMPORTE_PAG_VIDA , SUM(T.TOTAL_PAGADO) TOTAL_PAGADO FROM ( SELECT TO_CHAR(A.FEMOVIMI,'DD/MM/YYYY') FECHA_MOVIMIENTO , DECODE(A.CDCVEMOV,600,A.PTIMPORT,0) IMPORTE_DANOS , DECODE(A.CDCVEMOV,1600,A.PTIMPORT,0) IMPORTE_VIDA , A.PTIMPORT TOTAL , DECODE(NVL(B.CDCOMPRO,0),0,'',TO_CHAR(B.FECHAENV,'DD/MM/YYYY')) FECHA_PAGO , DECODE(NVL(B.CDCOMPRO,0),0,'',DECODE(B.CDMETPAG,'EFT',B.NMTRANSF,'CHK',B.NMCHEQUE,B.CDCOMPRO)) NUM_COMPROBANTE , DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,600,B.PTIMPPAG,0)) IMPORTE_PAG_DANOS, DECODE(NVL(B.CDCOMPRO,0),0,0,DECODE(B.CDCVEMOV,1600,B.PTIMPPAG,0)) IMPORTE_PAG_VIDA , DECODE(NVL(B.CDCOMPRO,0),0,0,B.PTIMPPAG) TOTAL_PAGADO , A.CDPROMOT PROMOTOR , B.NUMPRELI NUMPRELI FROM TSIA_MOVPROM A, MINTPSOFT B WHERE A.CDCVEMOV IN (600,1600) AND TRUNC(A.FEMOVIMI) BETWEEN to_date('{desde}','dd/mm/yyyy') AND to_date('{hasta}','dd/mm/yyyy') " \
						f"AND A.NUMPRELIQ = B.NUMPRELI(+) AND A.CDCVEMOV = B.CDCVEMOV(+) AND A.CDCONC = B.CDCONC (+) AND A.CDPROMOT = '{codigo}' AND A.CDMONEDA = 'USD') T GROUP BY T.PROMOTOR,T.NUMPRELI,T.FECHA_MOVIMIENTO,T.FECHA_PAGO,T.NUM_COMPROBANTE ORDER BY T.FECHA_MOVIMIENTO ASC"
	return query


def getheaderquery(clave,codigo,desde,hasta):
	str= ""
	if clave == 'A':
		str = f"SELECT DISTINCT d.dsnombre Nombre, a.cdagente Clave, d.cdideper RFC, e.dsdomici||', '||h.dsprovin||', '||f.dscoloni||', '||j.dsmunici||DECODE(e.cdpostal,NULL,NULL,', C.P. '||e.cdpostal) DIRECCION, 'Agente' Tipo_Productor, b.cdpromot||' - '||c.dspromot PROMOTORIA, a.cdagente Clave_Agente, LPAD(SUBSTR(PKG_Alea_Algoritmos_Cob.fr_Recup_CLABE(a.cdagente),-4),12,'*') CUENTA_CLABE, TO_CHAR(SYSDATE,'DD/MM/YYYY') PERIODO_CORTE, '{desde}' FEINICIO, '{hasta}' FEFIN, TO_CHAR((SELECT Min(feenvio) FROM tsia_movagen A ,BON_TPAGLIQ B WHERE B.NUMPRELIQ =A.NUMPRELIQ AND b.FEENVIO BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdagente= '{codigo}' AND B.CDAGPROU = A.CDAGENTE AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC ),'DD/MM/YYYY') FECHA_PRELIQ FROM tsia_movagen a, tsia_catagt b, tsia_promotor c, mpersona d,mdomicil e,tcolonia f,tmanteni g,tprovin h,tcodipos i,tmunici j WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','DD/MM/YYYY') AND TO_DATE('{hasta}','DD/MM/YYYY') AND a.cdagente = '{codigo}' AND a.cdagente = b.cdagente AND b.cdpromot = c.cdpromot AND b.cdperson = d.cdperson AND d.cdperson = e.cdperson AND e.nmorddom = 1 AND e.cdcoloni = f.cdcoloni AND g.cdtabla = 'TPAISES' AND g.codigo = e.cdpais AND h.cdprovin = j.cdprovin AND a.ptimport <> 0 AND i.cdcodpos = e.cdpostal and j.cdprovin = i.cdprovin and j.cdmunici = i.cdmunici"
	if clave == 'P':
		str = f"SELECT DISTINCT d.dsnombre Nombre, a.cdpromot Clave, d.cdideper RFC, e.dsdomici||', '||h.dsprovin||', '||f.dscoloni||', '||j.dsmunici||'. '||h.dsprovin||DECODE(e.cdpostal,NULL,NULL,', C.P. '||e.cdpostal) DIRECCION, 'Promotor' Tipo_Productor, ' ' PROMOTORIA, a.cdpromot Clave_Agente, LPAD(SUBSTR((SELECT clabe FROM rsa_mcuentas WHERE cdperson=c.cdperson and NMORDCTA=1 UNION SELECT cuenta FROM rsa_mctaint WHERE cdperson = c.cdperson AND NMORDCTA=1),-4),12,'*')  cuenta_bancaria, TO_CHAR(SYSDATE,'DD/MM/YYYY') PERIODO_CORTE, '{desde}' FEINICIO, '{hasta}' FEFIN, TO_CHAR((SELECT Min(feenvio) FROM tsia_movprom A ,BON_TPAGLIQ B WHERE B.NUMPRELIQ =A.NUMPRELIQ AND b.FEENVIO BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdpromot= '{codigo}' AND B.CDAGPROU = A.cdpromot AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC ),'DD/MM/YYYY') FECHA_PRELIQ FROM tsia_movprom a, tsia_promotor c, mpersona d, mdomicil e ,tcolonia f,tmanteni g,tprovin h,tcodipos i,tmunici j WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','DD/MM/YYYY') AND TO_DATE('{hasta}','DD/MM/YYYY') AND a.cdpromot = '{codigo}' AND a.cdpromot = c.cdpromot AND c.cdperson = d.cdperson AND d.cdperson = e.cdperson AND e.nmorddom = 1 AND e.cdcoloni = f.cdcoloni AND g.cdtabla = 'TPAISES' AND g.codigo = e.cdpais AND h.cdprovin = j.cdprovin AND a.ptimport <> 0 AND i.cdcodpos = e.cdpostal and j.cdprovin = i.cdprovin and j.cdmunici = i.cdmunici"
	if clave=='UDI':
		str = f"SELECT DISTINCT d.dsnombre Nombre, a.cdprovee Clave, d.cdideper RFC, e.dsdomici||', '||h.dsprovin||', '||f.dscoloni||', '||j.dsmunici||'. '||h.dsprovin||DECODE(e.cdpostal,NULL,NULL,', C.P. '||e.cdpostal) DIRECCION, 'Proveedor de Servicio' Tipo_Productor, ' ' PROMOTORIA, a.cdprovee Clave_Agente, LPAD(SUBSTR((SELECT clabe FROM rsa_mcuentas WHERE cdperson=c.cdperson and NMORDCTA=1 UNION SELECT cuenta FROM rsa_mctaint WHERE cdperson = c.cdperson AND NMORDCTA=1),-4),12,'*')  cuenta_bancaria, TO_CHAR(SYSDATE,'DD/MM/YYYY') PERIODO_CORTE, '{desde}' FEINICIO, '{hasta}' FEFIN, TO_CHAR((SELECT Min(feenvio) FROM tsia_movudi A ,BON_TPAGLIQ B WHERE B.NUMPRELIQ =A.NUMPRELIQ AND b.FEENVIO BETWEEN TO_DATE('{desde}','dd/mm/yyyy') AND TO_DATE('{hasta}','dd/mm/yyyy') AND a.cdprovee= '{codigo}' AND B.CDAGPROU = A.cdprovee AND B.CDCVEMOV = A.CDCVEMOV AND B.CDCONC = A.CDCONC ),'DD/MM/YYYY') FECHA_PRELIQ FROM tsia_movudi a, tsia_udi c, mpersona d, mdomicil e,tcolonia f,tmanteni g,tprovin h,tcodipos i,tmunici j WHERE TRUNC(a.femovimi) BETWEEN TO_DATE('{desde}','DD/MM/YYYY') AND TO_DATE('{hasta}','DD/MM/YYYY') AND a.cdprovee = '{codigo}' AND a.cdprovee = c.cdprovee AND c.cdperson = d.cdperson AND d.cdperson = e.cdperson AND e.nmorddom = 1 AND e.cdcoloni = f.cdcoloni AND g.cdtabla = 'TPAISES' AND g.codigo = e.cdpais AND h.cdprovin = j.cdprovin AND a.ptimport <> 0 AND i.cdcodpos = e.cdpostal and j.cdprovin = i.cdprovin and j.cdmunici = i.cdmunici"
	return str

def getheaderpdf(tipo,lista_aux,reporte):
	identificador = "Agente"
	if tipo == 'P':
		identificador = "Promotor"
	if tipo == 'UDI':
		identificador = "Prestador de servicio"
	return [("   ", "   ", " ", "   ", "   "),
				("Nombre del SAT para Sura:", "Seguros SURA S.A. de C.V", "     ", f"Nombre del {identificador}:", lista_aux[0]),
				("RFC de Sura:", "R.F.C R&S-811221KR6", "   ", f"Clave del {identificador}:", lista_aux[1]),
				("Domicilio Sura:", "Blvd. Adolfo López Mateos No. 2448", "   ", f"RFC del {identificador}:", lista_aux[2]),
				(" ", "Col. Altavista C.P. 01060 Ciudad de México.", "   ", f"Domicilio del {identificador}:", lista_aux[3]),
				("Periodo de corte:", " ", "   ", "Tipo de productor:", lista_aux[4]),
				("Desde:", lista_aux[9], "   ", "Promotoría a la que pertenece:", lista_aux[5]),
				("Hasta:", lista_aux[10], "   ", "Clave de productor:", lista_aux[6]),
				("Fecha de Preliquidación:", lista_aux[11], "   ", "Cuenta bancaria dada de alta:", lista_aux[7]),
				("   ", "   ", "   ", "   ", "   ")]

def getcolumnstosum(c_count):
	if c_count in [5, 6, 9, 10]:
		return [8,9,11,12,13]
	if c_count in [1, 2]:
		return [1,2,3,4,5,6,7]
	if c_count in [11, 12]:
		return [1,2,3,6,7,8]
	return 0


def getcolumnstosum_udi(c_count):
	if c_count in [1, 2]:
		return [1,2,3,4,5,6,7]
	if c_count in [5, 6]:
		return [12,13,14,16,17]
	if c_count in [7]:
		return [1,2,3]
	return 0


def getheaderforcompressed(lista,listab):
	listaresp = []
	len_lista=len(lista)
	len_listab=len(listab)
	mayor = len_lista
	if len_listab>len_lista:
		mayor=len_listab
	for i in range(mayor):
		if i<len_lista:
			vaux=lista[i][0]
			if vaux not in listaresp:
				listaresp.append(vaux)
		if i < len_listab:
			vaux = listab[i][0]
			if vaux not in listaresp:
				listaresp.append(vaux)
	listaresp[0]= 'Moneda'
	return listaresp


def get_tablas_referencia():
	ramos=[]
	ramo_style=[]
	bonos = []
	bono_style=[]
	#bonos
	bonos.append(['BONO POR EXCEPCION', ' ', 'BONO POR PORTAFOLIO', ' ','BONO CUADERNILLO', ' ', 'BONO PRESTADOR DE SERVICIO', ' '])
	bonos.append(['ABREVIATURA', 'TIPO DE BONO', 'ABREVIATURA', 'TIPO DE BONO','ABREVIATURA', 'TIPO DE BONO', 'ABREVIATURA', 'TIPO DE BONO'])
	bonos.append(['BS', 'BONO SINIESTRALIDAD', 'BC', 'BONO CRECIMIENTO','BP', 'BONO PRODUCCION', 'BP', 'BONO PRODUCCION'])
	bonos.append(['BP', 'BONO PRODUCCION', 'BP', 'BONO PRODUCCION', 'BS', 'BONO SINIESTRALIDAD', 'BPS', 'BONO PROD+SINIES'])
	bonos.append(['BPS', 'BONO PROD+SINIES', 'BCS', 'BONO CRECI+SINIES', 'BC', 'BONO CRECIMIENTO', 'BD', 'BONO DERECHOS'])
	bonos.append([' ', ' ', 'BPS', 'BONO PROD+SINIES', 'BPS', 'BONO PROD+SINIES', ' ', ' '])
	bonos.append([' ', ' ', 'BS', 'BONO SINIESTRALIDAD','BCS', 'BONO CRECI+SINIES', ' ', ' '])
	bonos.append([' ', ' ', 'BD', 'BONO DERECHOS',' ', ' ', ' ', ' '])

	bono_style = TableStyle(
		[('GRID', (0, 0), (-1, -1), 0.25, colors.white), ('ALIGN', (0, 0), (-1, -1), 'CENTER')])
	bono_style.add('SPAN', (0, 0), (1, 0))
	bono_style.add('SPAN', (2, 0), (3, 0))
	bono_style.add('SPAN', (4, 0), (5, 0))
	bono_style.add('SPAN', (6, 0), (7, 0))
	bono_style.add('BACKGROUND', (0, 0), (-1, 0), '#008080')
	bono_style.add('FONTNAME', (0, 0), (-1, 0), 'Arial_Bold')
	bono_style.add('TEXTCOLOR', (0, 0), (-1, 0), colors.white)
	bono_style.add('BACKGROUND', (0, 1), (-1, 1), '#10b0c2')
	bono_style.add('FONTNAME', (0, 1), (-1, 1), 'Arial_Bold')
	bono_style.add('TEXTCOLOR', (0, 1), (-1, 1), colors.white)
	for i in range(6):
		vcolor = '#e8eaea'
		if i % 2 == 0:
			vcolor = '#e2e4e4'
		bono_style.add('BACKGROUND', (0, i + 2), (-1, i + 2), vcolor)
		bono_style.add('TEXTCOLOR', (0, i + 2), (-1, i + 2), colors.black)
		bono_style.add('FONTNAME', (0, i + 2), (-1, i + 2), 'Arial')
	#ramos
	ramos.append(['CATALOGOS', ' ', ' ', ' ',' ', ' ', ' ', ' '])
	ramos.append(['CODIGO', 'DESCRIPCION', 'CODIGO', 'DESCRIPCION','CODIGO', 'DESCRIPCION', 'CODIGO', 'DESCRIPCION'])
	ramos.append(['101', 'INCENDIO', '105', 'TERREMOTO Y ERUPCIÓN VOLCÁNICA', '201', 'AUTOS RESIDENTES', '202', 'CAMIONES'])
	ramos.append(['203', 'TURISTAS', '204', 'AUTOBUSES', '205', 'MOTOCICLETAS', '206', 'SUVA'])
	ramos.append(['210', 'PRUEBAS DE AUTOS', '211', 'MOTOR TECHNICAL PRICING', '220', 'TAXIS', '301', 'TRANSPORTES CARGA'])
	ramos.append(['302', 'TRANSPORTE DE CASCOS MARÍTIMO', '303', 'TRANSPORTES DE CASCOS AVIACIÓN', '400', 'EQUIPO ELECTRÓNICO','401', 'ROTURA DE CRISTALES'])
	ramos.append(['402', 'OBJETOS PERSONALES', '403','EQUIPO DE CONTRATISTAS', '404', 'ROBO DE MERCANCÍAS', '405','ROTURA DE MAQUINARIA'])
	ramos.append(['406', 'CALDERAS', '407', 'MONTAJE DE MAQUINARIA', '409', 'DINERO Y VALORES', '410', 'ANUNCIOS LUMINOSOS'])
	ramos.append(['411', 'OBRA CIVIL', '412', 'PREMIOS', '413', 'OBRA CIVIL TERMINADA', '420', 'MÚLTIPLE FAMILIAR'])
	ramos.append(['421', 'PROTEGE CREDITOS', '422', 'MÚLTIPLE FAMILIAR', '430', 'MÚLTIPLE EMPRESARIAL', '431','PROTEGE CREDITOS'])
	ramos.append(['501', 'RESPONSABILIDAD CIVIL GENERAL', '502', 'RESPONSABILIDAD CIVIL FAMILIAR', '503','RESPONSABILIDAD CIVIL VIAJERO', '601', 'ACCIDENTES PERSONALES IND/FAM'])
	ramos.append(['602', 'ACC. PERSONALES ESCOLAR', '605', 'ACC. PERSONALES COLECTIVO', '606', 'GASTOS MÉDICOS MAYORES IND/FAM','607', 'GASTOS MÉDICOS MAYORES GRUPO'])
	ramos.append(['608', 'GASTOS MÉDICOS COLECTIVO', '610', 'PROTEGE FAMILIAR IND./FAM.', '701', 'CABALLOS', '702','SEGURO AGRÍCOLA'])
	ramos.append(['801', 'VIDA PRUEBA', '810', 'VIDA INDIV. MICROSEGURO 1 AÑO', '901', 'VIDA INDIVIDUAL', '902', 'VIDA GRUPO'])
	ramos.append(['903', 'VIDA COLECTIVO', '905', 'VIDA GRUPO DOTAL', '907', 'GASTOS FUNERARIOS', '908','VIDA GRUPO (SSIT, SSC)'])
	ramos.append(['909', 'CARTA DE COBERTURA', '931', 'VIDA INDIVIDUAL SURA', '990', 'ASISTENCIA HOGAR', '998','DAÑOS GASTOS FUNERARIOS'])
	ramos.append(['999', 'TODOS LOS RAMOS', '', '', '', '', '', ''])

	ramo_style = TableStyle(
		[('GRID', (0, 0), (-1, -1), 0.25, colors.white), ('ALIGN', (0, 0), (-1, -1), 'CENTER')])
	ramo_style.add('SPAN', (0, 0), (7, 0))
	ramo_style.add('BACKGROUND', (0, 0), (-1, 0), '#008080')
	ramo_style.add('FONTNAME', (0, 0), (-1, 0), 'Arial_Bold')
	ramo_style.add('TEXTCOLOR', (0, 0), (-1, 0), colors.white)
	ramo_style.add('BACKGROUND', (0, 1), (-1, 1), '#10b0c2')
	ramo_style.add('FONTNAME', (0, 1), (-1, 1), 'Arial_Bold')
	ramo_style.add('TEXTCOLOR', (0, 1), (-1, 1), colors.white)
	for i in range(15):
		vcolor='#e8eaea'
		if i %2==0:
			vcolor='#e2e4e4'
		ramo_style.add('BACKGROUND', (0, i+2), (-1, i+2), vcolor)
		ramo_style.add('TEXTCOLOR', (0, i+2), (-1, i+2), colors.black)
		ramo_style.add('FONTNAME', (0, i+2), (-1, i+2), 'Arial')
	return ramos,ramo_style,bonos,bono_style